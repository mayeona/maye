---
title: VM虚拟机安装ubuntu22.04.1
tags:
  - Ubuntu
  - 虚拟机
categories:
  - Linux
createTime: 2022/08/28 16:10:07
permalink: /article/hfgdbcz2/
---

## 前言

之前一直用 Hyper-v，但是管理控制台功能太少，遂决定转到 VMware 虚拟机，后续做集群、K8s等也方便管理。

## 1. 安装 ubuntu

安装 ubuntu 并设置静态 ip。

![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_01.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_02.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_03.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_04.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_05.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_06.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_07.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_08.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_09.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_10.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_11.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_12.webp)
![按空格选中](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_13.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_14.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_15.webp)
![](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/01_1_16.webp)

设置镜像源：

https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/  -> https://mirrors.tuna.tsinghua.edu.cn/ubuntu

https://mirrors.aliyun.com/ubuntu

阿里云比清华大学镜像快一些。

## 2. 设置虚拟机网络

虚拟机网络模式有三种，桥接、仅主机、NAT。经过比较后，选择 NAT 模式。
NAT 模式可以设置虚拟机网段，就不用受宿主机网络变化的影响了。

注意 nat 模式下，除了 ssh 可以用 192.168.10.100 访问到，譬如 30880 只能通过本机访问，在 vm 中配置端口转发

## 3. 设置 root 账户

设置 root 账户密码：sudo passwd root ，然后连续输入两次密码。切换到 root 账户：su root。切回普通用户：exit。

## 4. 主机开机自启

以 WMware Workstation 17 pro 为例，在`文件`->`配置启动虚拟机`，勾选你要启动的虚拟机即可。

> **可能遇到问题？**
>
> 提示无法更新`自动启动`配置，请确保存在`vmAutoStart.xml`文件，并且您有权写入此文件。

实际上这个文件是存在的，在`C:\ProgramData\VMware\VMware Workstation\vmAutoStart.xml`，文件内容示例如下：

```xml titile="vmAutoStart.xml" :no-line-numbers
<?xml version="1.0" encoding="UTF-8"?>
<!-- 配置虚拟机自动启动规则 -->
<ConfigRoot>
  <AutoStartOrder>
  <!-- 这里配置名为 devos 的虚拟机开机自启，顺序为 1 -->
    <e id="1">
      <vmname>devos</vmname>
      <vmxpath>C:\Users\<用户名>\Documents\Virtual Machines\devos\devos.vmx</vmxpath>
      <startOrder>1</startOrder>
    </e>
  </AutoStartOrder>
</ConfigRoot>
```

其实是没有写入权限，右键点击该文件`属性`→`安全`，确保当前用户或 SYSTEM 有`完全控制权`。

![PixPin_2025-06-18_05-46-49](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/PixPin_2025-06-18_05-46-49.7p3v2z01n8.webp)

按下`win+R`，输入`services.msc`找到`Vmware 自动启动服务`右击->`属性`，在`常规`->`启动类型`选择`自动`。

::: warning
不要使用`自动(延迟启动)`，否则可能自启无效。
:::

![PixPin_2025-06-18_08-56-32](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/PixPin_2025-06-18_08-56-32.8vn6brhkwc.webp)

接着继续在上面的 tab 栏中选择`登录`(这点**很重要**)。

如果是使用**本地账户**登录的选择：

![PixPin_2025-06-18_06-12-48](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/PixPin_2025-06-18_06-12-48.lvzndrq30.webp)

如果是使用**微软账户**登录的选择：

![PixPin_2025-06-18_06-14-37](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/PixPin_2025-06-18_06-14-37.92qe71aki5.webp)

然后重启主机就可以看到 VMware 会开机自启，并且其中的虚拟 devos 也会自动启动。

## 5. 主机关机关闭

让虚拟系统 devos 跟随主机关机，前提需要安装的是 VMware Workstation 且安装了 VMware Tools(一般默认会安装)。

我这里安装的 VMware Workstation 17 pro，在**虚拟系统关机**的情况下操作：

![PixPin_2025-06-18_07-38-16](https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2022-08-28/PixPin_2025-06-18_07-38-16.9dd809qfyr.webp)

---

::: note 本文参考

- [VMware workstation 17 pro 设置开机自启虚拟机（Windows 11）](https://www.cnblogs.com/funlyp/p/18801160)
- [VMware pro 17设置虚拟机随宿主机开机自启动](https://cloud.tencent.com/developer/article/2298022)

:::