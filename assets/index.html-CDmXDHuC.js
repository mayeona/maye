import{_ as i,c as a,b as n,o as e}from"./app-B_sKV6fk.js";const l={};function p(t,s){return e(),a("div",null,[...s[0]||(s[0]=[n(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>GitHub 上有挺多开源项目，可以一键 Fork 后自部署到 Cloudflare、Vercel 或其他平台，但我们往往需要修改为自己的配置。我希望的是在源文件中写好配置值，然后提交自动部署。当上游项目有更新时，拉取上游合并然后提交自动部署。但 Fork 的项目也必须是公开的，才能在页面上通过点击<code>Sync Fork</code>按钮来同步，可我仓库内的配置又不想暴露，所以仓库只能私有，但私有化仓库就必须离开 Fork 网络，也就不能通过点击<code>Sync Fork</code>按钮来同步了。那我们就得自己实现同步。</p><h2 id="实现同步" tabindex="-1"><a class="header-anchor" href="#实现同步"><span>实现同步</span></a></h2><p>我们以<a href="https://github.com/huangxd-/danmu_api" target="_blank" rel="noopener noreferrer">LogVar 弹幕</a>这个项目为例，这是一个非常灵活的弹幕服务，支持在 serverless 服务上部署。</p><p>首先 Fork 原仓库(https://github.com/huangxd-/danmu_api)到自己的仓库(https://github.com/mayeona/danmu_api)，然后在自己的仓库中设置为私有。</p><p>接着将自己的仓库 Clone 到本地，进行如下设置：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 创建 prod 分支(用于发布)，main 分支用于同步上游</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> branch</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> prod</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看当前远程仓库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> remote</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 显示</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># origin git@github.com:mayeona/danmu_api.git (fetch)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># origin git@github.com:mayeona/danmu_api.git (push)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 添加上游仓库，设置名称为 upstream</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> remote</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> upstream</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> git@github.com:huangxd-/danmu_api.git</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看当前远程仓库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> remote</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 显示</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># origin git@github.com:mayeona/danmu_api.git (fetch)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># origin git@github.com:mayeona/danmu_api.git (push)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># upstream git@github.com:huangxd-/danmu_api.git (fetch)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># upstream git@github.com:huangxd-/danmu_api.git (push)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># (可选)其实 upstream 我们是没有 push 权限的，为了明显一点，可以将 upstream 的 push 地址设置成一个无效地址</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> remote</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set-url</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --push</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> upstream</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> DISABLED</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 本地切到 main 分支</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> checkout</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 拉取上游 main 分支的代码</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> fetch</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> upstream</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 将 upstream 的 main 分支覆盖到本地的 main 分支</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reset</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --hard</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> upstream/main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># (可选)将 main 分支推送到远程仓库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> push</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> origin</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 切换到 prod 分支</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> checkout</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> prod</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 合并 main 分支到 prod 分支</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 这一步用可视化操作方便些，vscode 系可以用 Git Graph 插件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> merge</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 将 prod 分支推送到远程仓库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> push</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> origin</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> prod</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通常情况下将 prod 分支推送到远程后，就会自动触发 Hook 让 Vercel/Cloudflare 自动构建并发布了，但是这其中可能会存在隐藏问题。</p><p>当我们用<code>Git Graph</code>合并分支时，会弹出一个提示框，有三个选项：</p><ol><li><strong>Create a new commit even if fast-forward is possible</strong>: 产生新的提交，强制生成一个“合并节点”，在 Git 提交历史上会显示分叉，会保留合并分支的所有提交记录。这通常用于新版发布。</li><li><strong>Squash Commits</strong>: 产生新的提交，但合并分支的所有提交会被压缩成一个提交，这就会丢失历史提交记录。适用于无关紧要的提交历史，想让提交看起来整洁些的。</li><li><strong>No Commit</strong>: 仅合并代码但不提交。适用于合并代码后自己做些修改，之后再手动提交的。这个一般很少会用到。</li></ol><p>默认情况下我们可以都不勾选，直接点击<code>Merge</code>按钮即可。这就会触发<code>Fast-forward</code>合并，不会产生新的提交。但这会完全保留提交记录，包括提交者。可 Vercel 的自动构建很严格，要求提交者的邮箱和 GitHub 默认邮箱必须一致，否则不会构建。除非付费升级为团队协作，将其他人拉进团队，才可以触发自动构建。</p><p>如果我们已经通过<code>Fast-forward</code>合并了，导致不能自动构建，那么简单点可以创建一个新的空的提交，来触发自动构建。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --allow-empty</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">trigger vercel deploy</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>Tips: 如果是 GitHub 上的邮箱改了，可以修改 Git 全局配置，或者修改项目级的配置。</p><p>全局配置：<code>git config --global user.email &quot;your-email@example.com&quot;</code></p><p>项目级配置：<code>git config user.email &quot;your-email@example.com&quot;</code></p></blockquote><p>如果还没完成<code>Git Graph</code>合并，那么可以选择第 1 或 2 项，产生新的提交，提交人就是自己了，可以触发自动构建。</p>`,15)])])}const d=i(l,[["render",p]]),r=JSON.parse('{"path":"/article/xub0j8lj/","title":"私有仓库跟踪开源项目","lang":"zh-CN","frontmatter":{"title":"私有仓库跟踪开源项目","createTime":"2026/01/12 07:03:09","permalink":"/article/xub0j8lj/"},"readingTime":{"minutes":3.48,"words":1044},"git":{"createdTime":1769985102000,"updatedTime":1769985102000,"contributors":[{"name":"Mayee","username":"Mayee","email":"may675154357@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/Mayee?v=4","url":"https://github.com/Mayee"}]},"filePathRelative":"blog/6.技巧/7.私有仓库跟踪开源项目.md","headers":[],"categoryList":[{"id":"f5b792","sort":6,"name":"技巧"}]}');export{d as comp,r as data};
