import{_ as c,c as u,a as s,b as e,d as n,e as i,w as a,r as p,o as g}from"./app-B_sKV6fk.js";const A={},m={class:"vp-steps"},y={class:"code-block-title","data-title":"distfeeds.conf"},D={class:"code-block-title-bar"},v={class:"title"};function b(f,l){const t=p("VPLink"),k=p("Tabs"),o=p("Mermaid"),h=p("VPIcon");return g(),u("div",null,[l[54]||(l[54]=s("h2",{id:"前言",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#前言"},[s("span",null,"前言")])],-1)),s("p",null,[l[2]||(l[2]=i("在上一篇文章",-1)),n(t,{href:"/article/ajedbv3c/"},{default:a(()=>[...l[0]||(l[0]=[i("家庭网络配置",-1)])]),_:1}),l[3]||(l[3]=i("中提到我的 R2S 刷了",-1)),l[4]||(l[4]=s("a",{href:"https://github.com/QiuSimons/YAOF",target:"_blank",rel:"noopener noreferrer"},"YAOF",-1)),l[5]||(l[5]=i("的固件后，网速能跑带宽，猜测可能是",-1)),l[6]||(l[6]=s("code",null,"LAN",-1)),l[7]||(l[7]=i("口与",-1)),l[8]||(l[8]=s("code",null,"WAN",-1)),l[9]||(l[9]=i("口交换的缘故，而在后来的折腾中发现好像不是这样，可能单是因为",-1)),l[10]||(l[10]=s("code",null,"iStoreOS",-1)),l[11]||(l[11]=i("的固件跑不满带宽。",-1)),l[12]||(l[12]=s("br",null,null,-1)),l[13]||(l[13]=i(" 之所以有了这篇文章，是因为我需要在软路由的 Docker 中部署几个电视直播源(部署方式见",-1)),n(t,{href:"/article/pqozqzh6/"},{default:a(()=>[...l[1]||(l[1]=[i("电视直播相关汇总",-1)])]),_:1}),l[14]||(l[14]=i(")，但是 Docker 分区下的磁盘空间太小了，下载启动了两个容器就没空间了。于是在网上寻找",-1)),l[15]||(l[15]=s("code",null,"Docker分区扩容",-1)),l[16]||(l[16]=i("的方法，其中有个简单的方式就是创建一个新分区，然后挂载路径为 Docker 根目录",-1)),l[17]||(l[17]=s("code",null,"/opt/docker",-1)),l[18]||(l[18]=i("，但是操作完后没有达到预期效果，后来继续寻找方法，最终促使我将",-1)),l[19]||(l[19]=s("code",null,"YAOF",-1)),l[20]||(l[20]=i("的固件替换为了",-1)),l[21]||(l[21]=s("code",null,"ImmortalWrt",-1)),l[22]||(l[22]=i("的固件。实际上YAOF固件貌似也是基于ImmortalWrt固件编译的，选择YAOF就是拿来直接用，选择ImmortalWrt则更精简，便于自定义。",-1))]),l[55]||(l[55]=e('<h2 id="_1-固件选择" tabindex="-1"><a class="header-anchor" href="#_1-固件选择"><span>1. 固件选择</span></a></h2><p><code>OpenWrt</code>是一个针对嵌入式设备的路由器系统(Linux操作系统)，常见固件：官方Openwrt、ImmortalWrt、Lean固件、iStoreOS等。<br> 官方OpenWrt在国外，软件包商店需要代理访问，而ImmortalWrt针对中国用户做了优化，软件包商店可直接访问，并且跟随官方更新。</p><p>固件下载地址：<a href="https://firmware-selector.openwrt.org/" target="_blank" rel="noopener noreferrer">OpenWrt</a>、<a href="https://firmware-selector.immortalwrt.org/" target="_blank" rel="noopener noreferrer">ImmortalWrt</a>。输入设备型号搜索(如：R2S)，然后下载固件即可，这里我选择的是 ImmortalWrt 固件。</p><h3 id="_1-1-ext4-和-squashfs-怎么选" tabindex="-1"><a class="header-anchor" href="#_1-1-ext4-和-squashfs-怎么选"><span>1.1 EXT4 和 SQUASHFS 怎么选</span></a></h3><p>详细的解释请见<a href="https://github.com/QiuSimons/YAOF/discussions/511" target="_blank" rel="noopener noreferrer">「扫盲帖」ext4/sfs 固件怎么选择，有什么区别</a>、<a href="https://github.com/QiuSimons/YAOF/discussions/114" target="_blank" rel="noopener noreferrer">ext4和sfs有什么区别</a>，或者自行 Google 搜索。<br> 简单点来说，SQUASHFS 可以重置、扩容镜像和直接升级，而 EXT4 都不能。<br> 对于 arm 设备推荐 SQUASHFS 固件，对于 x86 设备推荐 EXT4 固件。由于 R2S 是 arm 设备，这里我选择的是 SQUASHFS 固件。</p><h2 id="_2-分区扩容" tabindex="-1"><a class="header-anchor" href="#_2-分区扩容"><span>2. 分区扩容</span></a></h2><h3 id="_2-1-安装前扩容-推荐" tabindex="-1"><a class="header-anchor" href="#_2-1-安装前扩容-推荐"><span>2.1 安装前扩容(推荐)</span></a></h3><p>安装前扩容也就是对镜像扩容，仅针对 SQUASHFS 格式。扩容镜像需要在 Linux 环境下，可以是 Openwrt、Debian、Ubuntu 等。这种操作方式相对简单，更推荐使用。</p>',8)),s("div",m,[s("ol",null,[l[47]||(l[47]=s("li",null,[s("p",null,"检查命令"),s("p",null,[i("分别执行"),s("code",null,"which gzip"),i("、"),s("code",null,"which dd"),i("、"),s("code",null,"which parted"),i("命令，检查这些软件是否存在，若不存在则安装，安装方式在不同 Linux 发行版上稍有差异，但都很简单，具体 Google。")])],-1)),s("li",null,[l[40]||(l[40]=s("p",null,"上传固件",-1)),s("p",null,[l[24]||(l[24]=i("把下载好的固件(如：",-1)),l[25]||(l[25]=s("code",null,"immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img.gz",-1)),l[26]||(l[26]=i(")上传至 Linux 环境中，上传位置随意。",-1)),l[27]||(l[27]=s("br",null,null,-1)),l[28]||(l[28]=i(" 这里，我是在 Windows 系统中启用 WSL2 运行了 Ubuntu 系统，打开",-1)),l[29]||(l[29]=s("code",null,"powershell",-1)),l[30]||(l[30]=i("输入",-1)),l[31]||(l[31]=s("code",null,"wsl",-1)),l[32]||(l[32]=i("命令连接到 Ubuntu 系统(具体请见",-1)),n(t,{href:"/article/ryxmiytl/"},{default:a(()=>[...l[23]||(l[23]=[i("WSL2使用",-1)])]),_:1}),l[33]||(l[33]=i(")。",-1)),l[34]||(l[34]=s("br",null,null,-1)),l[35]||(l[35]=i(" WSL 和 Windows 系统之间文件交换有个小技巧，在命令行中任意目录下输入",-1)),l[36]||(l[36]=s("code",null,"explorer.exe .",-1)),l[37]||(l[37]=i("就能在资源管理器中打开当前目录；或者手动打开资源管理器，然后在地址栏中输入",-1)),l[38]||(l[38]=s("code",null,"\\\\wsl$\\",-1)),l[39]||(l[39]=i("就能打开WSL系统中的目录，然后直接复制粘贴文件即可。",-1))])]),s("li",null,[l[46]||(l[46]=e(`<p>执行命令</p><p>按顺序执行以下命令(命令中的镜像名字根据实际填写)。注意，如果是 EFI 的固件，在执行这些命令过程中可能会弹出 2 项提示，分别选择：<code>OK</code>、<code>FIX</code>即可。</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 解压缩镜像文件，解压完成后这个文件就没用了，可删</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> gzip</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -kd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img.gz</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 解压成功后获得到 immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 扩展镜像文件的大小 (count=2048 表示增加 2048 * 1MB 的空间)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 注意扩容也不是越大越好，因为扩容会增大镜像的体积，这意味着镜像大小将会增加 2GB。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> dd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> if=/dev/zero</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bs=1M</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> count=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2048</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 使用分区工具操作镜像</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> parted</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 查看分区情况</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> print</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 调整分区大小 (将第 2 个分区扩展至镜像文件的 100%)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 也就是将第 2 个分区大小加了 2GB，这个分区一般是用来安装插件使用的。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> resizepart</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 100%</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 查看是否扩展成功</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> print</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 退出分区工具</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> quit</span></span></code></pre></div>`,3)),s("p",null,[l[42]||(l[42]=i("之后把",-1)),l[43]||(l[43]=s("code",null,"immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img",-1)),l[44]||(l[44]=i("文件拷贝到 Windows 系统中，然后直接刷入这个固件即可。刷入固件的操作步骤在",-1)),n(t,{href:"/article/3ocurxag/"},{default:a(()=>[...l[41]||(l[41]=[i("软路由之R2S使用",-1)])]),_:1}),l[45]||(l[45]=i("一文中有详细记录，这里便不再赘述。",-1))])])])]),l[56]||(l[56]=s("h3",{id:"_2-2-安装后扩容",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_2-2-安装后扩容"},[s("span",null,"2.2 安装后扩容")])],-1)),l[57]||(l[57]=s("p",null,"建议先配置好 OpenWrt 的网络，使之可以访问互联网，因为接下来可能需要安装软件。",-1)),n(k,{id:"68",data:[{id:"SQUASHFS 格式"},{id:"EXT4 格式"}]},{title0:a(({value:d,isActive:r})=>[...l[48]||(l[48]=[i("SQUASHFS 格式",-1)])]),title1:a(({value:d,isActive:r})=>[...l[49]||(l[49]=[i("EXT4 格式",-1)])]),tab0:a(({value:d,isActive:r})=>[...l[50]||(l[50]=[s("div",{class:"vp-steps"},[s("ol",null,[s("li",null,[s("p",null,"更新软件包"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"软件包"),i("页面点击"),s("code",null,"更新列表")])]),s("li",null,[s("p",null,"安装分区工具"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"软件包"),i("页面搜索"),s("code",null,"diskman"),i("，然后选择"),s("code",null,"luci-i18n-diskman-zh-cn"),i("安装。刷新页面后可在"),s("code",null,"系统"),i("菜单下看到"),s("code",null,"磁盘管理"),i("。")])]),s("li",null,[s("p",null,"禁用自动挂载"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"挂载点"),i(">"),s("code",null,"全局设置"),i("区域，取消勾选所有的自动挂载项，然后点击"),s("code",null,"保存并应用"),i("。")])]),s("li",null,[s("p",null,"创建分区"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"磁盘管理"),i(">"),s("code",null,"磁盘"),i("区域点"),s("code",null,"编辑"),i("，然后在弹出页面的"),s("code",null,"分区信息"),i("中最下方，"),s("code",null,"中止扇区"),i("位置填写"),s("code",null,"+2g"),i("(根据自己需要调整大小，支持的容量格式有：b,k,m,g,t，如：+500m，+1t 等)，格式化为 EXT4 文件系统，然后点击"),s("code",null,"新建"),i("，即可创建一个 2GB 空间大小的分区。"),s("br"),i(" 注：中止扇区的计算方式，以增加 2GB 为例：((2*1024*1024*1024)/512)+[起始扇区]-1，得到的结果即为中止扇区的值。")])]),s("li",null,[s("p",null,"挂载分区"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"挂载点"),i(">"),s("code",null,"挂载点"),i("区域点击"),s("code",null,"添加"),i("，在"),s("code",null,"常规设置"),i("一栏的"),s("code",null,"UUID"),i("选中刚刚创建的分区(记下分区名)，"),s("code",null,"挂载点"),i("选择"),s("code",null,"作为根文件系统使用(/)"),i("。然后复制下方显示出来的多行命令，暂存到记事本中，之后点击"),s("code",null,"保存"),i("，再点击"),s("code",null,"保存并应用"),i("。")])]),s("li",null,[s("p",null,"执行命令"),s("p",null,[i("使用"),s("code",null,"ssh root@192.168.100.1"),i("登录到系统(这里"),s("code",null,"root"),i("是用户名，"),s("code",null,"192.168.100.1"),i("是软路由系统的地址，根据实际情况填写)，将刚才复制的多行命令中，其中"),s("code",null,"/dev/sda1"),i("修改为"),s("code",null,"/dev/实际创建的分区名"),i("，然后复制粘贴到命令行窗口，多点几次回车，直到执行完成。")])]),s("li",null,[s("p",null,"重启系统"),s("p",null,"重启软路由系统。")])])],-1)])]),tab1:a(({value:d,isActive:r})=>[...l[51]||(l[51]=[s("div",{class:"vp-steps"},[s("ol",null,[s("li",null,[s("p",null,"更新软件包"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"软件包"),i("页面点击"),s("code",null,"更新列表")])]),s("li",null,[s("p",null,"安装分区工具"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"软件包"),i("页面搜索"),s("code",null,"diskman"),i("，然后选择"),s("code",null,"luci-i18n-diskman-zh-cn"),i("安装。刷新页面后可在"),s("code",null,"系统"),i("菜单下看到"),s("code",null,"磁盘管理"),i("。")])]),s("li",null,[s("p",null,"禁用自动挂载"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"挂载点"),i(">"),s("code",null,"全局设置"),i("区域，取消勾选所有的自动挂载项，然后点击"),s("code",null,"保存并应用"),i("。")])]),s("li",null,[s("p",null,"创建分区"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"磁盘管理"),i(">"),s("code",null,"磁盘"),i("区域点"),s("code",null,"编辑"),i("，然后在弹出页面的"),s("code",null,"分区信息"),i("中最下方，"),s("code",null,"中止扇区"),i("位置填写"),s("code",null,"+2g"),i("(根据自己需要调整大小，支持的容量格式有：b,k,m,g,t，如：+500m，+1t 等)，格式化为 EXT4 文件系统，然后点击"),s("code",null,"新建"),i("，即可创建一个 2GB 空间大小的分区。"),s("br"),i(" 题外话：中止扇区的计算方式，以增加 2GB 为例：((2*1024*1024*1024)/512)+[起始扇区]-1，得到的结果即为中止扇区的值。")])]),s("li",null,[s("p",null,"挂载分区"),s("p",null,[i("在"),s("code",null,"系统"),i(">"),s("code",null,"挂载点"),i(">"),s("code",null,"挂载点"),i("区域点击"),s("code",null,"添加"),i("，在"),s("code",null,"常规设置"),i("一栏的"),s("code",null,"UUID"),i("选中刚刚创建的分区(记下分区名)，"),s("code",null,"挂载点"),i("例如为"),s("code",null,"/mnt/sda3"),i("，sda3 可随意命令，目的是拷贝overlay文件用。之后点击"),s("code",null,"保存"),i("，再点击"),s("code",null,"保存并应用"),i("。")])]),s("li",null,[s("p",null,"执行命令"),s("p",null,[i("使用"),s("code",null,"ssh root@192.168.100.1"),i("登录到系统(这里"),s("code",null,"root"),i("是用户名，"),s("code",null,"192.168.100.1"),i("是软路由系统的地址，根据实际情况填写)，执行命令"),s("code",null,"cp -r /overlay/* /mnt/sda3"),i("，将原overlay下的配置拷贝至新分区。")])]),s("li",null,[s("p",null,"检查分区"),s("p",null,[i("查看新分区目录是否拷贝成功，如果成功则在"),s("code",null,"系统"),i(">"),s("code",null,"挂载点"),i(">"),s("code",null,"挂载点"),i("区域删除刚才的"),s("code",null,"/mnt/sda3"),i("挂载。")])]),s("li",null,[s("p",null,"重新挂载分区"),s("p",null,[i("再次进入"),s("code",null,"系统"),i(">"),s("code",null,"挂载点"),i(">"),s("code",null,"挂载点"),i("区域点击"),s("code",null,"添加"),i("，选择刚才的新分区，"),s("code",null,"挂载点"),i("选择为"),s("code",null,"作为外部 overlay 使用(/overlay)"),i("，之后点击"),s("code",null,"保存"),i("，再点击"),s("code",null,"保存并应用"),i("。")])]),s("li",null,[s("p",null,"重启系统"),s("p",null,"重启软路由系统。")])])],-1)])]),_:1}),l[58]||(l[58]=e('<h2 id="_3-安装-docker" tabindex="-1"><a class="header-anchor" href="#_3-安装-docker"><span>3. 安装 Docker</span></a></h2><p>在安装 Docker 前，我们可以先安装<code>argon</code>主题。在<code>软件包</code>页面更新列表后，搜索<code>argon</code>，然后选择<code>luci-theme-argon</code>安装即可，如果需要设置主体再安装<code>luci-i18n-argon-config-zh-cn</code>。<br> Docker 使用的根目录通常是<code>/opt/docker</code>，在安装之前，最好手动创建一个分区并挂载到<code>/opt/docker</code>，否则若直接安装 Docker 会自动创建分区挂载到根目录下，那样会限制使用。</p><div class="vp-steps"><ol><li><p>创建分区</p><p>进入<code>系统</code>&gt;<code>磁盘管理</code>&gt;<code>磁盘</code>区域点<code>编辑</code>，然后在弹出页面的<code>分区信息</code>中最下方，<code>中止扇区</code>位置填写<code>+20g</code>(根据个人需求，+10g也行)。如果有使用<code>AdGuardHome</code>的需求，必须将分区格式化化为<code>btrfs</code>，否则亦可格式化为<code>ext4</code>。</p></li><li><p>挂载分区</p><p>进入<code>系统</code>&gt;<code>挂载点</code>&gt;<code>挂载点</code>区域点击<code>添加</code>，选择刚才的新分区，<code>挂载点</code>为<code>/opt/docker</code>，之后点击<code>保存</code>，再点击<code>保存并应用</code>。</p></li><li><p>安装 Docker</p><p>在<code>系统</code>&gt;<code>软件包</code>页面点击<code>更新列表</code>，然后搜索<code>docker</code>，然后选择<code>luci-i18n-dockerman-zh-cn</code>安装。<br> 安装完成后建议等上3~5分钟，后台可能有操作没执行完。之后刷新页面后可在菜单下看到<code>Docker</code>。</p></li></ol></div><p>启动 Docker 后便可在<code>Docker</code>&gt;<code>概览</code>中看到<code>Docker 根目录</code>的空间大小。亦可通过 ssh 命令进入到软路由系统中，使用<code>df -h /opt/docker</code>查看 Docker 分区大小。</p><p>之后便可部署直播源或者其他容器啦~~</p><h2 id="_4-配置防火墙" tabindex="-1"><a class="header-anchor" href="#_4-配置防火墙"><span>4. 配置防火墙</span></a></h2><p>上面在部署完直播源后，容器运行正常，查看日志也正常，通过 ssh 进入到软路由系统中去访问 Docker 容器也正常，但就是使用其他非软路由设备无法访问到 Docker 容器。<br> 这大概率就是防火墙不通导致，于是了解了下 OpenWrt 防火墙的概念。下面这个图表达了防火墙各设备之间的概念关系。</p>',7)),n(o,{code:"eJzT1dXlKsksyUm1UvAvSM0LLypReDlj0/PG1U8XzXyxd83T/olPWzc/37ybC6QwvSixIEPBJ4iLq7g0Ccpx9Hvas+vp/PlcCgqJ0Uov1u17uqTdUcPQ0kjP0MxCz0DP0FBTKRYomQSTdEKSNDKCSCbDJJ3hkoZ6xsYQyUQFG11dO4WaJ7uWPOtd9GzOLoi7apJApkLlIG542tb6Yvv651M2QlUkc6XmpXBxpUQrwfUiuwxkPMIn4XCfpEY/2TXpReOU53snxkJMgCtyyU/OTi2CqkuLfrpu59OZKwxjudKhTCOoBniwoLjv5fQtKO5DWEmcehTbkTlE2sIFAHTq5xs="}),n(o,{code:"eJzT1dXlKsksyUm1UvAvSM0LLypReDlj0/PG1U8XzXzavutp69Lnq2c+bd38fPNuLpDa9KLEggwFnyAurpzEvOinba3P906M5SoHsZdMA7OLyzOjn+xa8qx30bM5u2LB6hR0de0UaiBm1QDlQeoxxIAYKta+CyQG1IchBtTHxQUAqE1Sug=="}),l[59]||(l[59]=e(`<p>这里有几个概念：转发、出入站。</p><ul><li>转发：区域内相同网段(192.168.0.*)由交换机直接转发，不受防火墙控制；区域内不同网段(192.168.0.*与192.168.1.*)以及区域间的转发，由路由转发，受防火墙控制。</li><li>出入站：这里的站是指路由器，流入路由器的数据就是入站，流出路由器的数据就是出站。</li></ul><p>在了解了上述这些之后，可以想到，<code>LAN区域</code>-&gt;<code>Docker区域</code>必须能转发，并且<code>Docker区域</code>-&gt;<code>WAN区域</code>必须也能转发，所以防火墙的配置如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/20250211/openwrt.9nzwsujca9.webp" alt="openwrt"></p><p>至此，便可正常获取到电视直播源并且观看了。</p><p>OpenWrt 的折腾暂时告一段落~~</p><h2 id="_5-配置pwmfan" tabindex="-1"><a class="header-anchor" href="#_5-配置pwmfan"><span>5. 配置PWMFAN</span></a></h2><p>原版的 R2S 固件中是有 pwmfan 的，也就是根据 CPU 温度控制风扇是否启用。但由于我们刷的是并非原版固件，所以当前固件中是没有这个设置的，只能通过脚本方式来执行。</p><div class="vp-steps"><ol><li><p>下载脚本</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 下载 start-rk3328-pwm-fan.sh</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -P</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/bin</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://raw.githubusercontent.com/friendlyarm/friendlywrt/refs/heads/master-v19.07.1/target/linux/rockchip-rk3328/base-files/usr/bin/start-rk3328-pwm-fan.sh</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 下载 fa-rk3328-pwmfan</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -P</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/init.d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://raw.githubusercontent.com/friendlyarm/friendlywrt/refs/heads/master-v19.07.1/target/linux/rockchip-rk3328/base-files/etc/init.d/fa-rk3328-pwmfan</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行脚本</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 添加执行权限</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/bin/start-rk3328-pwm-fan.sh</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/init.d/fa-rk3328-pwmfan</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 执行脚本</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   /etc/init.d/fa-rk3328-pwmfan</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   /etc/init.d/fa-rk3328-pwmfan</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></div><h2 id="_6-官方源" tabindex="-1"><a class="header-anchor" href="#_6-官方源"><span>6. 官方源</span></a></h2><p>如果不小心删掉了官方源，则可以在后台<code>系统</code>-&gt;<code>软件包</code>点击<code>配置 opkg</code>:</p><ul><li><code>/etc/opkg.conf</code>: 一般不需要改动。仅在需要修改安装目录或设置代理时手动配置。</li><li><code>/etc/opkg/customfeeds.conf</code>: 一般不需要改动。仅在需要添加第三方源或本地仓库时手动配置。</li><li><code>/etc/opkg/distfeeds.conf</code>: 必须配置。官方源的核心配置文件，确保正确填写以访问官方软件包。</li></ul>`,12)),s("div",y,[s("div",D,[s("span",v,[n(h,{provider:"iconify",name:"vscode-icons:file-type-config"}),l[52]||(l[52]=i("distfeeds.conf",-1))])]),l[53]||(l[53]=e(`<div class="language-text" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-text"><span class="line"><span>src/gz base https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/packages</span></span>
<span class="line"><span>src/gz luci https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/luci</span></span>
<span class="line"><span>src/gz packages https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/base</span></span>
<span class="line"><span>src/gz routing https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/routing</span></span>
<span class="line"><span>src/gz telephony https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/telephony</span></span></code></pre></div>`,1))]),l[60]||(l[60]=e(`<p><strong>注意</strong>：<code>24.10.1</code>是系统版本，<code>aarch64_generic</code>是 CPU 架构，要根据实际情况填写。</p><h2 id="_7-固件编译" tabindex="-1"><a class="header-anchor" href="#_7-固件编译"><span>7. 固件编译</span></a></h2><p>官方固件<a href="https://firmware-selector.immortalwrt.org/" target="_blank" rel="noopener noreferrer">下载</a>页提供了个性化编译的界面，可以增加预安装软件包(得是官方源有的才行)，和首次运行脚本。这里我提供一个脚本如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#!/bin/sh</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># /etc/uci-defaults/99-setup.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 设置 LAN 口 ip</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.lan.proto=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">static</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.lan.ipaddr=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.0.1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.lan.netmask=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">255.255.255.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 设置 pppoe 拨号</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#uci set network.wan.proto=&#39;pppoe&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#uci set network.wan.username=&#39;123456&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#uci set network.wan.password=&#39;123456&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 设置访问光猫</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem=interface</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.proto=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">static</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.ipaddr=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.1.254</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.netmask=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">255.255.255.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.ifname=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">eth0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.defaultroute=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 提交生效</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">exit</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此脚本会在首次启动时自动运行，正常退出后会自动删除该脚本。</p><hr><h2 id="_8-ipv6配置" tabindex="-1"><a class="header-anchor" href="#_8-ipv6配置"><span>8. IPv6配置</span></a></h2><p>为了内网中的服务能被公网通过 IPv6 访问(访问内网的 Sub-Store 服务)，还需要做如下两处设置(仅适用于主路由模式下)，默认情况下它们都是<code>已禁用</code>：</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/20250211/ipv6.8hgta5g6kk.webp" alt="ipv6"></p><div class="hint-container note"><p class="hint-container-title">本文参考</p><ul><li><a href="https://www.qichiyu.com/183.html#heading-2-1" target="_blank" rel="noopener noreferrer">openwrt基础配置</a></li></ul></div>`,10))])}const C=c(A,[["render",b]]),w=JSON.parse('{"path":"/article/tgd9dxlo/","title":"ImmortalWrt系统使用","lang":"zh-CN","frontmatter":{"title":"ImmortalWrt系统使用","tags":["R2S","ImmortalWrt"],"categories":["网络"],"createTime":"2025/02/11 19:02:47","permalink":"/article/tgd9dxlo/"},"readingTime":{"minutes":11.92,"words":3576},"git":{"createdTime":1769985102000,"updatedTime":1769985102000,"contributors":[{"name":"Mayee","username":"Mayee","email":"may675154357@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/Mayee?v=4","url":"https://github.com/Mayee"}]},"filePathRelative":"blog/2.网络/4.ImmortalWrt系统使用.md","headers":[],"categoryList":[{"id":"dbc378","sort":2,"name":"网络"}]}');export{C as comp,w as data};
