import{_ as g,c as y,b as t,a as s,d as n,e as a,w as l,r as e,o}from"./app-B_sKV6fk.js";const A={},c={class:"vp-steps"},D={class:"vp-steps"},B={class:"vp-file-tree"},u={class:"code-block-title","data-title":"svnserve.conf"},v={class:"code-block-title-bar"},m={class:"title"},C={class:"vp-file-tree"},f={class:"code-block-title","data-title":"sync-svn-delete.sh"},E={class:"code-block-title-bar"},b={class:"title"},q={class:"code-block-title","data-title":"tasjs.json"},F={class:"code-block-title-bar"},w={class:"title"};function x(T,i){const r=e("VPLink"),p=e("Annotation"),d=e("VPCard"),k=e("VPIcon"),h=e("FileTreeNode");return o(),y("div",null,[i[57]||(i[57]=t('<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>闲言少叙，总而言之就是又折腾了 R2S，把之前用的原本 ImmortalWrt 换成了 YAOF 的 OpenWrt 系统，原因是集成的插件多，好用省心。按照惯例，记录下本次折腾过程中碰到的麻烦事。</p><h2 id="_1-固件刷入" tabindex="-1"><a class="header-anchor" href="#_1-固件刷入"><span>1. 固件刷入</span></a></h2><p>这里选择的固件版本是<a href="https://github.com/QiuSimons/YAOF/releases/tag/23.05.5" target="_blank" rel="noopener noreferrer">23.05.5-sfs</a>，因为这是最后一个支持 docker 的版本。为什么选择这个，自己动手安装不香吗？不香，有点麻烦，因为这个固件用的源中的软件和 ImmortalWrt 用的相比有挺多没有的。当然可以替换源，或者动手去网上找各种<code>luci-*-all.ipk</code>的插件上传安装，但是说了麻烦，做减法比做加法容易，既然有集成好的用就是了，一味的追求系统版本没意义，只要用起来稳定，让人省心，那就是好的。</p><p>固件刷写注意事项：</p>',5)),s("ul",null,[s("li",null,[i[1]||(i[1]=a("刷入前：进行扩容，保证给软件安装预留充足空间，不用太多，增加 1G 足以。",-1)),n(r,{href:"/article/tgd9dxlo/#_2-1-%E5%AE%89%E8%A3%85%E5%89%8D%E6%89%A9%E5%AE%B9-%E6%8E%A8%E8%8D%90"},{default:l(()=>[...i[0]||(i[0]=[a("扩容方式",-1)])]),_:1}),i[2]||(i[2]=a("；",-1))]),i[3]||(i[3]=s("li",null,"刷入中：跟以前一样；",-1)),i[4]||(i[4]=s("li",null,[a("刷入后：启动进入系统后，不要启动 docker，磁盘分个区给 docker，这里我分了6G 空间足够用了。然后挂载分区到"),s("code",null,"/opt/docker"),a("；")],-1))]),i[58]||(i[58]=t(`<p>未提及的操作照旧即可。</p><p>顺便提一下这个固件内置的软件源：</p><div class="language-text" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-text"><span class="line"><span>src/gz openwrt_core https://mirrors.pku.edu.cn/openwrt/releases/23.05.5/targets/rockchip/armv8/packages</span></span>
<span class="line"><span>src/gz openwrt_base https://mirrors.pku.edu.cn/openwrt/releases/23.05.5/packages/aarch64_generic/base</span></span>
<span class="line"><span>src/gz openwrt_luci https://mirrors.pku.edu.cn/openwrt/releases/23.05.5/packages/aarch64_generic/luci</span></span>
<span class="line"><span>src/gz openwrt_packages https://mirrors.pku.edu.cn/openwrt/releases/23.05.5/packages/aarch64_generic/packages</span></span>
<span class="line"><span>src/gz openwrt_routing https://mirrors.pku.edu.cn/openwrt/releases/23.05.5/packages/aarch64_generic/routing</span></span>
<span class="line"><span>src/gz openwrt_telephony https://mirrors.pku.edu.cn/openwrt/releases/23.05.5/packages/aarch64_generic/telephony</span></span></code></pre></div><p>如果要替换为 ImmortalWrt 的软件源，只需要按照上述格式，把地址换成<code>https://downloads.immortalwrt.org/</code>。但是换源之后可能会有意想不到的问题，比如原固件的插件使用的依赖在原来的源中找得到，但是在新源可能找不到或者版本不可用。操作有风险，换源需谨慎。</p><p><strong>Tip</strong>：sfs 的固件能够重置，当系统无法正常启动时，不要立马刷机，先尝试断电后插拔 TF 卡，然后重新上电长按<code>reset</code>键，之后观察<code>sys</code>指示灯的变化。当红灯快速闪烁表示正在重置中，慢闪表示系统正常启动中，长亮表示系统正常运行中。重置固件后虽然需要重新设置系统，但是 TF 卡上存储的文件不会丢失。</p><h2 id="_2-安装插件" tabindex="-1"><a class="header-anchor" href="#_2-安装插件"><span>2. 安装插件</span></a></h2><h3 id="_2-1-tailscale" tabindex="-1"><a class="header-anchor" href="#_2-1-tailscale"><span>2.1 Tailscale</span></a></h3><p><code>Tailscale</code>的作用就不必多说了，内网穿透神器。与之齐名的还有<code>Zerotier</code>，为啥不用这个？因为这个设置起来费老鼻子劲了，很折腾，而且免费计划只支持最多3个网络➕10个设备，按说差不多够用了，但是感觉捉襟见肘。但<code>Tailscale</code>的安装就非常方便，并且免费计划支持3个用户➕100个设备，大气多了，用不完，根本用不完😄。</p><p>在安装插件前，先到软件包中安装<code>iptables-nft</code>，这个是必要的依赖。之后上<a href="https://github.com/asvow/luci-app-tailscale/releases" target="_blank" rel="noopener noreferrer">luci-app-tailscale</a>下载最新版就完事，记得下载的是<code>luci-app-tailscale_*_all.ipk</code>，然后上传安装即可，启动后会自动设置好上网接口以及防火墙。入口在 OpenWrt 系统的<code>服务</code>下面。</p><p><code>Tailscale</code>的使用也很简单，登录了相同账号的设备就能互相访问。这里有个关键的地方，当安装了<code>Tailscale</code>的软路由为主路由模式时，在 OpenWrt 的 Tailscale 的<code>高级设置</code>下把<strong>暴露子网</strong>配置好，这样内网中的所有设备即使没有安装<code>Tailscale</code>也可以被访问到，在外网的设备只需要打开<code>Tailscale</code>就能像在内网中一样访问。</p><p><strong>注意</strong>：每个设备登录后是有时效的，默认有效期 3 个月，可以在<a href="https://login.tailscale.com/admin/settings/device-management" target="_blank" rel="noopener noreferrer">控制台</a>调整。如果你想不失效，就在<a href="https://login.tailscale.com/admin/machines" target="_blank" rel="noopener noreferrer">控制台</a>选中设备后点击<code>Disable key expiry</code>。</p><p>再就是，当你想要他人加入你的<code>tailnet</code>，有三种选择：</p><ol><li>登录到 Tailscale 的<a href="https://login.tailscale.com/admin/settings/keys" target="_blank" rel="noopener noreferrer">控制台</a>配置一个<code>Auth keys</code>，他人使用你这个 Auth keys 登录，即可将他的设备加入到你的<code>tailnet</code>中。优点是，不用泄露你的密码；缺点是，Auth keys 最大有效期为 90 天。</li><li>他人正常登录其账号，你<a href="https://login.tailscale.com/admin/users" target="_blank" rel="noopener noreferrer">邀请</a>对方的账号到你的<code>tailnet</code>中。邀请成功后，需要对方重新登录其账号，此时就能看到有若干选项，要求其选择一个<code>tailnet</code>加入，那么选择你的即可。优点是，无有有效期限制；缺点是，占用一个用户的名额。</li><li>他人正常登录其账号，你在 Tailscale 的<a href="https://login.tailscale.com/admin/machines" target="_blank" rel="noopener noreferrer">控制台</a>选择一个设备分享给对方，对方接受要求后，你的设备就出现在了对方的<code>tailnet</code>中。</li></ol><p>上面三种方式的不同点：</p><ul><li>第 1 种，是他的设备加入到你的网络中，会占用你的设备限额，默认可以访问你账号下的所有设备，包括暴露出的子网，你也可以访问他的设备，可以编写<code>ACL</code>控制权限。用的是你的账号；</li><li>第 2 种，是他的设备加入到你的网络中，会占用你的设备限额，并且会占用你的用户限额，默认可以访问你账号下的所有设备，包括暴露出的子网，你也可以访问他的设备，可以编写<code>ACL</code>控制权限。用的是他的账号；</li><li>第 3 种，是你的设备加入他的网络中，会占用他的设备限额，他只能访问你分享的这个设备，即使此设备下有子网他也不能访问，但你分享的这个设备并不能访问他的网络，由于他并不在你的网络中，所以你无需也不能编写<code>ACL</code>控制权限。用的是他账号；</li></ul><p>熟悉以上区别，选择合适的分享策略。</p><p><strong>注意</strong>：Tailscale 通过 IPv6 直连速度就比较快，能保证正常使用，但如果以 IPv4 连接，若当前没有公网且网络 NAT 层数过多，则无法直连，就会走中转服务器，你懂的，那就非常慢了，慢到无法使用。<br> 所以，一种方式就是家庭内网拨号时获取 IPv6 地址，运营商一般会下发，如果没有那就没得玩，而手机通过蜂窝数据上网一般也都是有 IPv6 的，两端都是 IPv6 就可以直连；另一种方式就是自建 Derp 中继服务器，但那就需要有一台具有公网 IP 的服务器，一般是买云服务器，要钱的方案不在白嫖党的选择范围。</p><h3 id="_2-2-navidrome" tabindex="-1"><a class="header-anchor" href="#_2-2-navidrome"><span>2.2 Navidrome</span></a></h3><p><a href="https://www.navidrome.org/" target="_blank" rel="noopener noreferrer">官网</a>，这是一个可以提供音乐分享的服务，我们可以在软路由上运行它来搭建自己的音乐私服，配合内网穿透后就可以无限制听音乐了。<br><strong>注意</strong>：这仅仅是一个可以提供音乐分享的服务，它本身是没有任何音乐的，所有的音乐内容还是得自己去搞定，一劳永逸。</p><p>下载插件<a href="https://github.com/tty228/luci-app-navidrome/releases" target="_blank" rel="noopener noreferrer">luci-app-navidrome</a>并上传安装，入口在 OpenWrt 系统的<code>服务</code>下面。<br> 安装完成后先不要急着启动，去<code>磁盘管理</code>分一个区用来存放音乐。分多大看个人情况，我没有其他需求，把剩余所有空间都分出来了。分区完后进行挂载，挂载路径随意，我这里是<code>/opt/navidrome</code>。<br> 在启动插件之前，设置好插件的各种目录，并确保这些目录都存在，否则启动会失败，之后正常启动浏览器访问操作即可。</p><h3 id="_2-3-samba" tabindex="-1"><a class="header-anchor" href="#_2-3-samba"><span>2.3 Samba</span></a></h3><p>Samba 协议可以用来在设备之间共享文件，Windows 和 Linux 系统都支持，不过需要做一些设置才能启用。</p>`,22)),n(d,{title:"Linux",icon:"simple-icons:linux"},{default:l(()=>[s("div",c,[s("ol",null,[s("li",null,[i[22]||(i[22]=s("p",null,"安装 Samba",-1)),s("p",null,[i[8]||(i[8]=a("在软件包中搜索下载",-1)),i[9]||(i[9]=s("code",null,"shadow-useradd",-1)),i[10]||(i[10]=a()),n(p,{label:"useradd",total:1},{"item-0":l(()=>[...i[5]||(i[5]=[s("p",null,"Linux下创建用户的工具",-1)])]),_:1}),i[11]||(i[11]=a("、",-1)),i[12]||(i[12]=s("code",null,"luci-app-samba4",-1)),i[13]||(i[13]=a()),n(p,{label:"samba",total:1},{"item-0":l(()=>[...i[6]||(i[6]=[s("p",null,"基于Luci的samba服务器",-1)])]),_:1}),i[14]||(i[14]=a("和",-1)),i[15]||(i[15]=s("code",null,"luci-i18n-samba4-zh-cn",-1)),i[16]||(i[16]=a()),n(p,{label:"i18n-samba",total:1},{"item-0":l(()=>[...i[7]||(i[7]=[s("p",null,"luci-app-samba4的简体中文包",-1)])]),_:1}),i[17]||(i[17]=a("，若已安装则忽略。安装完成后，入口在",-1)),i[18]||(i[18]=s("code",null,"服务",-1)),i[19]||(i[19]=a("->",-1)),i[20]||(i[20]=s("code",null,"网络共享",-1)),i[21]||(i[21]=a("。",-1))])]),i[23]||(i[23]=s("li",null,[s("p",null,"创建 Samba 用户"),s("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash",style:{"--shiki-light":"#393a34","--shiki-dark":"#dbd7caee","--shiki-light-bg":"#ffffff","--shiki-dark-bg":"#121212"}},[s("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code"},[s("code",{class:"language-bash"},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"useradd"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," samba"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 添加名为 samba 的用户")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"smbpasswd"),s("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," -a"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," samba"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 为用户 samba 创建 smb 服务的密码")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"mkdir"),s("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," -p"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," /opt/navidrome/music"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 创建一个目录用于共享（已存在则忽略）")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}},"# 使用户 samba 获得目录权限。这一步很重要，否则当使用 Samba 客户端连接时会提示：没有权限。")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"chown"),s("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," -R"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," samba:samba"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," /opt/navidrome/music"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 或者执行 chmod -R 777 /opt/navidrome/music")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}},"# 如果创建的 samba 用户不想用了")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"smbpasswd"),s("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," -x"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," samba"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 删除用户 samba 的密码")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"userdel"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," samba"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 删除用户")]),a(`
`),s("span",{class:"line"}),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}},"# 相关命令")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"service"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," samba4"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," start"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 启动服务")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"service"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," samba4"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," stop"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 停止服务")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"service"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," samba4"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," restart"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 重启服务")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"service"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," samba4"),s("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}}," status"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 服务状态")]),a(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"testparm"),s("span",{style:{"--shiki-light":"#A65E2B","--shiki-dark":"#C99076"}}," -v"),s("span",{style:{"--shiki-light":"#A0ADA0","--shiki-dark":"#758575DD"}}," # 配置文件检查")])])])])],-1)),i[24]||(i[24]=s("li",null,[s("p",null,"设置共享"),s("p",null,[a("在"),s("code",null,"服务"),a("->"),s("code",null,"网络共享"),a("的"),s("code",null,"常规设置"),a("下，"),s("strong",null,"接口"),a("选择"),s("code",null,"lan"),a("；"),s("strong",null,"允许旧协议"),a("可以选择性勾选，默认不用。"),s("br"),a(" 在"),s("code",null,"共享目录"),a("下需要设置的选项：")]),s("table",null,[s("thead",null,[s("tr",null,[s("th",null,"名称"),s("th",null,"路径"),s("th",null,"可浏览"),s("th",null,"允许用户"),s("th",null,"创建权限掩码"),s("th",null,"目录权限掩码")])]),s("tbody",null,[s("tr",null,[s("td",null,"music"),s("td",null,"/opt/navidrome/music"),s("td",null,"✔"),s("td",null,"samba"),s("td",null,"0666"),s("td",null,"0777")])])]),s("p",null,[s("code",null,"保存并应用"),a("，然后用命令重启 Samba 服务。")]),s("p",null,[s("strong",null,"注意"),a("：当使用 ios 或 macos 进行 samba 交互时，会导致上传使用，此时需要勾选"),s("code",null,"启用 macOS 兼容共享"),a("就能正常上传了，但又会引发其他可能的问题，如在快捷指令中列出 samba 服务上的目录，就无数据返回，对此，我的解决方法是用下面 Alist 提供的接口请求即可。")])],-1))])])]),_:1}),n(d,{title:"Windows",icon:"simple-icons:windows"},{default:l(()=>[...i[25]||(i[25]=[s("p",null,[a("打开"),s("code",null,"控制面板"),a("，在"),s("code",null,"程序和功能"),a("->"),s("code",null,"启用或关闭 Windows 功能"),a("中，勾选"),s("code",null,"SMB 1.0/CIFS 文件共享支持"),a("和"),s("code",null,"SMB 直通"),a("。"),s("br"),a(" 启用完成后，按"),s("code",null,"Win+E"),a("打开文件资源管理器，在地址栏输入"),s("code",null,"\\\\192.168.0.1"),a("双击"),s("code",null,"music"),a("目录后输入前面创建的账户/密码即可。")],-1)])]),_:1}),i[59]||(i[59]=t('<p>如此一来，就可能很方便的上传音乐了，搭配内网穿透，可以随时随地的操作。</p><h3 id="_2-4-alist" tabindex="-1"><a class="header-anchor" href="#_2-4-alist"><span>2.4 AList</span></a></h3><p>可以使用 AList 将 smb 转接为 webdav 服务，这是最简单、方便且功能强大的方式。在软件包下搜索<code>luci-i18n-alist-zh-cn</code>安装即可。之后的使用方式这里不多说，参考<a href="https://alistgo.com/zh/guide/" target="_blank" rel="noopener noreferrer">文档</a>即可。<br> 值得注意的是，AList 完全可以用过 api 的方式来操作，通过 http 的方式来请求，但默认情况下<code>guest</code>用户是禁用的，这就导致我们所有的 api 操作都需要鉴权。有的时候仅仅是查看目录，此时可以将<code>guest</code>用户启用即可，即使不给于任何权限，也是可以查看的。</p><h3 id="_2-5-svn" tabindex="-1"><a class="header-anchor" href="#_2-5-svn"><span>2.5 SVN</span></a></h3><p>有时候需要一个文件版本控制系统，即方便在多台主机上管理文件，也方便文件回溯。Git 协议的服务对于 R2S 来说可能比较占资源，不过 SVN 是非常轻量的。<br> 在<code>系统</code>-&gt;<code>软件包</code>中搜索<code>subversion</code>，可以看到三个包：<code>subversion-client</code>、<code>subversion-libs</code>、<code>subversion-server</code>。其中 libs 包是其他两个的依赖包，如果只是作为服务端使用，安装<code>subversion-server</code>即可，会自动安装<code>subversion-libs</code>依赖包。安装完成后安装如下步骤来初始化：</p>',5)),s("div",D,[s("ol",null,[s("li",null,[i[33]||(i[33]=t(`<p>创建 SVN 仓库</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /srv/svn</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /srv/svn</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 创建一个名为 repos 的仓库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svnadmin</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> repos</span></span></code></pre></div><p>执行完后，目录结构类似：</p>`,3)),s("div",B,[n(h,{expanded:"",type:"folder",filename:"repos",level:0},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),default:l(()=>[n(h,{expanded:"",type:"folder",filename:"conf",level:2},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:folder-type-config"})]),comment:l(()=>[...i[26]||(i[26]=[a("# 配置文件(如 passwd、authz)",-1)])]),default:l(()=>[n(h,{type:"file",filename:"authz",level:3},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-file"})]),comment:l(()=>[...i[27]||(i[27]=[a("# 用户权限",-1)])]),_:1}),n(h,{type:"file",filename:"passwd",level:3},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-file"})]),comment:l(()=>[...i[28]||(i[28]=[a("# 账号密码",-1)])]),_:1}),n(h,{type:"file",filename:"svnserve.conf",level:3},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:file-type-config"})]),comment:l(()=>[...i[29]||(i[29]=[a("# 服务器配置",-1)])]),_:1})]),_:1}),n(h,{type:"folder",filename:"db",level:2},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:folder-type-db"})]),comment:l(()=>[...i[30]||(i[30]=[a("# 版本历史、文件内容、元数据都在这里！",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:3})]),_:1}),n(h,{type:"folder",filename:"format",level:2},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),default:l(()=>[n(h,{type:"file",filename:"…",level:3})]),_:1}),n(h,{type:"folder",filename:"hooks",level:2},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:folder-type-hook"})]),comment:l(()=>[...i[31]||(i[31]=[a("# 钩子脚本(如 post-commit)",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:3})]),_:1}),n(h,{type:"folder",filename:"locks",level:2},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[32]||(i[32]=[a("# 锁文件",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:3})]),_:1}),n(h,{type:"file",filename:"README.txt",level:2},{icon:l(()=>[n(k,{provider:"iconify",name:"flat-color-icons:info"})]),_:1})]),_:1})])]),s("li",null,[i[36]||(i[36]=s("p",null,"配置 SVN 用户和权限",-1)),i[37]||(i[37]=s("p",null,[a("修改"),s("code",null,"repos/conf/svnserve.conf"),a("启用身份验证：")],-1)),s("div",u,[s("div",v,[s("span",m,[n(k,{provider:"iconify",name:"vscode-icons:file-type-config"}),i[34]||(i[34]=a("svnserve.conf",-1))])]),i[35]||(i[35]=t(`<div class="language-ini" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">general</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">anon-access</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> none</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">auth-access</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> write</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">password-db</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> passwd</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">authz-db</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> authz</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">realm</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> R2S Repos</span></span></code></pre></div>`,1))]),i[38]||(i[38]=t(`<p>修改<code>repos/conf/passwd</code>，添加用户名密码：</p><div class="code-block-title" data-title="passwd"><div class="code-block-title-bar"><span class="title">passwd</span></div><div class="language-ini" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">users</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">admin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> admin</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">b560m</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 123456</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">winmi</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> 123456</span></span></code></pre></div></div><p>修改<code>repos/conf/authz</code>，配置权限：</p><div class="code-block-title" data-title="authz"><div class="code-block-title-bar"><span class="title">authz</span></div><div class="language-ini" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">groups</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 定义了两个组(名称随意)，为组赋予了成员</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">admin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> admin</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">dev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> b560m,winmi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">/</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># * 表示匿名，* = r 表示匿名可以读(r)到 / 下的仓库</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 如果不想匿名看到所有就 * =  ，不给任何权限</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">* = r</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">@</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">admin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> rw</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 因为仓库为 repos，所以一定要是 repos:&lt;子路径&gt;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">repos:/sub-store</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">@</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">dev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> rw</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">repos:/proxy-server</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">@</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">dev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> rw</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">repos:/assist-tool</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">@</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">dev</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> rw</span></span></code></pre></div></div><p>通过这种配置，可以在启动一个 svn 服务的情况下，管理多个子目录，每个子目录即表示一个代码库。</p>`,5))]),i[51]||(i[51]=t(`<li><p>重启 SVN 服务</p><p>修改<code>/etc/config/subversion</code>的内容：</p><div class="code-block-title" data-title="subversion"><div class="code-block-title-bar"><span class="title">subversion</span></div><div class="language-ini" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">config subversion</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">     option path     </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/srv/svn</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">     option port     </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">3690</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span></code></pre></div></div><p>注意，服务启动的路径在<code>/srv/svn</code>，实际创建的仓库应该在其子目录下，然后重启 SVN 服务<code>service subversion restart</code>。</p></li>`,1)),s("li",null,[i[48]||(i[48]=s("p",null,"客户端连接",-1)),i[49]||(i[49]=s("p",null,"注意，直接在服务器上的仓库下创建子目录是无效的，那不会被 svn 管理，正确的做法是由管理员先拉取整个仓库到本地，然后在本地创建好目录结构：",-1)),s("div",C,[n(h,{expanded:"",type:"folder",filename:"svn-repos",level:0},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),default:l(()=>[n(h,{expanded:"",type:"folder",filename:"assist-tool",level:2},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),default:l(()=>[n(h,{type:"folder",filename:"trunk",level:3},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[39]||(i[39]=[a("# 主干",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:4})]),_:1}),n(h,{type:"folder",filename:"braches",level:3},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[40]||(i[40]=[a("# 分支",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:4})]),_:1}),n(h,{type:"folder",filename:"tags",level:3},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[41]||(i[41]=[a("# 版本快照",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:4})]),_:1})]),_:1}),n(h,{type:"folder",filename:"proxy-server",level:2},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),default:l(()=>[n(h,{type:"folder",filename:"trunk",level:3},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[42]||(i[42]=[a("# 主干",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:4})]),_:1}),n(h,{type:"folder",filename:"braches",level:3},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[43]||(i[43]=[a("# 分支",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:4})]),_:1}),n(h,{type:"folder",filename:"tags",level:3},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[44]||(i[44]=[a("# 版本快照",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:4})]),_:1})]),_:1}),n(h,{type:"folder",filename:"sub-store",level:2},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),default:l(()=>[n(h,{type:"folder",filename:"trunk",level:4},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[45]||(i[45]=[a("# 主干",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:5})]),_:1}),n(h,{type:"folder",filename:"braches",level:4},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[46]||(i[46]=[a("# 分支",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:5})]),_:1}),n(h,{type:"folder",filename:"tags",level:4},{icon:l(()=>[n(k,{provider:"iconify",name:"vscode-icons:default-folder"})]),comment:l(()=>[...i[47]||(i[47]=[a("# 版本快照",-1)])]),default:l(()=>[n(h,{type:"file",filename:"…",level:5})]),_:1})]),_:1})]),_:1})]),i[50]||(i[50]=t(`<div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 管理员拉取整个仓库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> checkout</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> svn://192.168.0.1/repos</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --username</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> admin</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> password</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> admin</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 开发者拉取子目录</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> checkout</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> svn://192.168.0.1/repos/sub-store</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --username</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> winmi</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> password</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 123456</span></span></code></pre></div><p>之后可以<code>add/commit/update/log</code>等常规操作了。</p>`,2))])]),i[56]||(i[56]=t(`<p><strong>注意</strong>：上传到 SVN 的文件都在<code>db</code>目录中，但不是原样存储，而是被压缩、编码、分块成数据库形式。如你想导出完整版本库的内容为一个普通文件夹，可以用：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> export</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> svn://192.168.0.1/repos</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 或者使用 dump，可以导出整个仓库，包含提交记录。用于崩溃恢复或服务器迁移</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svnadmin</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dump</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /srv/svn/repos</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/svn-repos.dump</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 然后在恢复的服务器上创建仓库</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svnadmin</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> repos</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 接着恢复 dump</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svnadmin</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> load</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /srv/svn/repos</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ~/svn-repos.dump</span></span></code></pre></div><p>SVN 与 Git 不同点：</p><ul><li>svn 不像 git 那样通过一个<code>.gitignore</code>文件就可以忽略多个、多级的文件/目录，svn 只能手动设置忽略单个文件/目录，每次忽略其实是设置目录的属性，因此设置忽略的操作也是要提交的。</li><li>svn 不像 git 在本地删除了跟踪的文件后提交即可同步删除远程文件，svn 必须要使用<code>svn delete</code>命令删除文件然后提交才可以。</li></ul><p>当使用 svn 管理时，删除了多个文件如何批量提交呢？有两种方式：</p><p><strong>方法一</strong>：使用如下命令：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">^!</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> sed</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">s/^! *//</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> while</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> IFS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> read</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> do</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> delete</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$file</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> done</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">批量删除被本地手动删除的文件</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>方法二</strong>：创建脚本<code>sync-svn-delete.sh</code>以及 VSCode 的 task 文件<code>.vscode/tasks.json</code>实现点击运行。</p>`,8)),s("div",f,[s("div",E,[s("span",b,[n(k,{provider:"iconify",name:"vscode-icons:file-type-shell"}),i[52]||(i[52]=a("sync-svn-delete.sh",-1))])]),i[53]||(i[53]=t(`<div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 自动同步本地被手动删除的文件到 SVN 仓库</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> trunk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">📁 正在扫描本地被删除的文件...</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">deleted_files</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=$(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">^!</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> sed</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">s/^! *//</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -z</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$deleted_files</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ];</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> then</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">✅ 没有检测到需要同步删除的文件。</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    exit</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$deleted_files</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> while</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> IFS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> read</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> do</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">➖ 删除：$file</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> delete</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$file</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">done</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">🚀 提交到 SVN...</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">同步删除本地手动删除的文件</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre></div>`,1))]),s("div",q,[s("div",F,[s("span",w,[n(k,{provider:"iconify",name:"vscode-icons:file-type-json"}),i[54]||(i[54]=a("tasjs.json",-1))])]),i[55]||(i[55]=t(`<div class="language-json" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">version</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">2.0.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">tasks</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">            &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">label</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">同步 SVN 删除文件</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">            &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">shell</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">            &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">command</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">\${workspaceFolder}/.vscode/sync-svn-delete.sh</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">            &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">problemMatcher</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [],</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">            &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">options</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">                &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">shell</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">                    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">executable</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">C:</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\\\\</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Program Files</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\\\\</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Git</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\\\\</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">bin</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">\\\\</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">bash.exe</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            },</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">            &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">presentation</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">                &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">reveal</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">always</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            },</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">            &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">group</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">                &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">kind</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">build</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">                &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">isDefault</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    ]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div>`,1))])]),i[60]||(i[60]=t(`<p>当使用图形化客户端，比如 TortoiseSVN 检出时，默认会缓存首次输入的用户和密码，如果想要切换用户则需要删除<code>C:\\Users\\&lt;用户名&gt;\\AppData\\Roaming\\Subversion\\auth</code>(Windows)或<code>~/.subversion/auth</code>(Linux/MacOS)，在下次操作 SVN 时就会要求输入用户/密码。</p><p>如果是用命令行操作可以：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">svn</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> checkout</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> svn://192.168.0.1/repos</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --username</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> admin</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --password</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> admin</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --no-auth-cache</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --non-interactive</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --quiet</span></span></code></pre></div><p><code>-no-auth-cache</code>表示不缓存密码，<code>--non-interactive</code>避免交互式输入密码，适合脚本，<code>--quiet</code>表示静默的不输出详情。</p><p>为了维护仓库代码的安全，应该有定时任务每天自动导出整个仓库代码，脚本如下：</p><details class="hint-container details"><summary>点击查看代码</summary><div class="language-py line-numbers-mode" data-highlighter="shiki" data-ext="py" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-py"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> sys</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> pathlib </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Path</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> shutil</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> subprocess</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> datetime </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> datetime</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> os</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> re</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> zipfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">TMP</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/tmp/svn-bak</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 临时文件目录</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">BAK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/srv/share/代码库/svn</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 备份文件目录</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">LIMIT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 5</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 最大备份数量</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> init</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 删除临时目录(避免 checkout 失败)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">TMP</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">).</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">exists</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        shutil</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rmtree</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">TMP</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 创建目录，包括中间目录</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">TMP</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">).</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mkdir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">parents</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">True</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> exist_ok</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">True</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">BAK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">).</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mkdir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">parents</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">True</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> exist_ok</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">True</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> zip</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">source_dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> zip_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    source_dir </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">abspath</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">source_dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 确保是绝对路径</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    with</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> zipfile</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ZipFile</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">zip_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">w</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> zipfile</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">ZIP_DEFLATED</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> zipf</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> root</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> _</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> files </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">in</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">walk</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">source_dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            for</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> file</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> in</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> files</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                abs_file_path </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">join</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                rel_path </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">relpath</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">abs_file_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">dirname</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">source_dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                zipf</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">write</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">abs_file_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> arcname</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rel_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> main</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">():</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;时间：</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">datetime</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">now</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">().</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">strftime</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%Y-%m-</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">%d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> %H:%M:%S</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">|svn repos 仓库备份&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sys</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">stderr</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    cmd </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">svn</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">export</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">svn://127.0.0.1/repos</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">{TMP}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/repos&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">--username</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">admin</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">--password</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">admin</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">--non-interactive</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">--no-auth-cache</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">--quiet</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    ]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> subprocess</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cmd</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">capture_output</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">True</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">text</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">True</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> result</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">returncode </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">!=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">checkout failed: </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> +</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> result</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">stderr</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sys</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">stderr</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        sys</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">exit</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 压缩备份</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    zip</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">{TMP}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/repos&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">{BAK}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/reposbak-</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">{</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">datetime</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">now</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">().</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">strftime</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%Y%m</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">%d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%H%M%S</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">}</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.zip&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    pattern </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> re</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">compile</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">r</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5E3F;--shiki-dark:#C4704F;">reposbak-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">\\d</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">{14}</span><span style="--shiki-light:#BDA437;--shiki-dark:#E6CC77;">\\.</span><span style="--shiki-light:#AB5E3F;--shiki-dark:#C4704F;">zip</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    files </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">f </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> f </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">in</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">listdir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">BAK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> pattern</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">fullmatch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">f</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 如果压缩包数量超过限制</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    if</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> len</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">files</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> LIMIT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # 保留最近的时间</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        files</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sort</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">reverse</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">True</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # 其余全部删除</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> f </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">in</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> files</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">LIMIT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:]:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">remove</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">join</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">BAK</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> f</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 删掉临时目录(因为不需要了)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    shutil</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rmtree</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">TMP</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 0 2 * * * /usr/bin/python /usr/local/bin/svnrepo-backup.py &gt;&gt; /var/log/svnrepo-backup.log 2&gt;&amp;1</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">if</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> __name__</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> ==</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">__main__</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    init</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    main</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><hr><div class="hint-container note"><p class="hint-container-title">本文参考</p><ul><li><a href="https://doc.embedfire.com/openwrt/user_manal/zh/latest/User_Manual/openwrt/samba.html#samba" target="_blank" rel="noopener noreferrer">安装Samba</a></li><li><a href="https://skyao.io/learning-openwrt/docs/share/samba/" target="_blank" rel="noopener noreferrer">设置OpenWRT的samba共享</a></li><li><a href="https://iyzm.net/openwrt/105.html" target="_blank" rel="noopener noreferrer">OpenWrt局域网文件共享软件之samba4</a></li></ul></div>`,8))])}const z=g(A,[["render",x]]),_=JSON.parse('{"path":"/article/0be86xd9/","title":"OpenWrt系统使用","lang":"zh-CN","frontmatter":{"title":"OpenWrt系统使用","tags":["R2S","OpenWrt"],"categories":["网络"],"createTime":"2025/04/13 02:17:22","permalink":"/article/0be86xd9/"},"readingTime":{"minutes":14.77,"words":4430},"git":{"createdTime":1769985102000,"updatedTime":1769985102000,"contributors":[{"name":"Mayee","username":"Mayee","email":"may675154357@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/Mayee?v=4","url":"https://github.com/Mayee"}]},"filePathRelative":"blog/2.网络/5.OpenWrt系统使用.md","headers":[],"categoryList":[{"id":"dbc378","sort":2,"name":"网络"}]}');export{z as comp,_ as data};
