import{_ as i,c as a,b as n,o as h}from"./app-B_sKV6fk.js";const t={};function e(k,s){return h(),a("div",null,[...s[0]||(s[0]=[n(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>在 OpenWrt 系统中也想把某些脚本或者软件注册为系统服务，实现当系统启动时自动启动，并且可以通过系统服务来管理，那么就可以用<code>service</code>来实现。</p><h2 id="_1-注册服务" tabindex="-1"><a class="header-anchor" href="#_1-注册服务"><span>1. 注册服务</span></a></h2><p>可以启用<code>procd</code>管理。例如，我们有一个<code>httpRandomMusic.py</code>的脚本实现了某些功能，脚本放在哪里都可以，但要注意给执行权限，那么我们可以编写启动脚本，如下所示：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#!/bin/sh /etc/rc.common</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">START</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">99</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">USE_PROCD</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 启用 procd 管理</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">start_service</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    procd_open_instance</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    procd_set_param</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> command</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/sh</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -c</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/usr/bin/python3 /usr/bin/httpRandomMusic.py &gt;&gt; /var/log/http-random-music.log 2&gt;&amp;1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    procd_set_param</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> respawn</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # 如果崩溃了自动重启</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    procd_close_instance</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><p><strong>注意</strong>：最好是在<code>VScode</code>或者其他编辑器下进行，不要用 Windows 自带的记事本编辑，因为会涉及到换行符(LF/CRLF)的问题，Windows 下默认会使用<code>CRLF</code>换行符，这是隐藏字符默认不显示，但是放在 Linux 环境下执行就会报错。还有就是，这个启动脚本文件没有后缀名。</p><p>接着，把这个启动脚本放在<code>/etc/init.d</code>目录下，并且执行<code>chmod +x</code>赋予执行权限，然后就可以在 OpenWrt 系统 Web 页面上的<code>系统</code>-&gt;<code>启动项</code>下看到它了。</p><h2 id="_2-管理服务" tabindex="-1"><a class="header-anchor" href="#_2-管理服务"><span>2. 管理服务</span></a></h2><p>我们可以通过<code>service</code>命令来查看所有服务的运行状态。实际上<code>service &lt;service-name&gt; &lt;command&gt;</code>命令等同于运行<code>/etc/init.d/&lt;service-name&gt; &lt;command&gt;</code>。例如：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">/etc/init.d/network</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dnsmasq</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reload</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> uhttpd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span></span></code></pre></div><p>每个服务可能定义了不同的附加命令，如 reload_config、dump、check 等。可以用<code>/etc/init.d/&lt;service-name&gt;</code>或<code>service &lt;service-name&gt; help</code>来查看支持的命令列表。例如：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 输入：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dockerman</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> help</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 输出：</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Available</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commands:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        start</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">           Start</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        stop</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">            Stop</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">         Restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        reload</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          Reload</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> configuration</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> files</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (or </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> if</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> does</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> not</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> implement</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reload</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        enable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          Enable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> autostart</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        disable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">         Disable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> autostart</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        enabled</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">         Check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> if</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> is</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> started</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> boot</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        add_ports</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">       Add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> allowed</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ports</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> based</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> the</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> container</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ID</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">s</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        convert</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">         Convert</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Ac</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> allowed</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> container</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> AC</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> allowed</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ports</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        running</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">         Check</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> if</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> is</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> running</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        status</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">          Service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> status</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        trace</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">           Start</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> with</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> syscall</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> trace</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        info</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">            Dump</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> procd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> info</span></span></code></pre></div>`,12)])])}const p=i(t,[["render",e]]),r=JSON.parse('{"path":"/article/ju1rctsm/","title":"OpenWrt系统下注册service服务","lang":"zh-CN","frontmatter":{"title":"OpenWrt系统下注册service服务","tags":["OpenWrt"],"categories":["技巧"],"createTime":"2025/05/06 11:39:17","permalink":"/article/ju1rctsm/"},"readingTime":{"minutes":1.76,"words":528},"git":{"createdTime":1769985102000,"updatedTime":1769985102000,"contributors":[{"name":"Mayee","username":"Mayee","email":"may675154357@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/Mayee?v=4","url":"https://github.com/Mayee"}]},"filePathRelative":"blog/6.技巧/3.OpenWrt系统下注册service服务.md","headers":[],"categoryList":[{"id":"f5b792","sort":6,"name":"技巧"}]}');export{p as comp,r as data};
