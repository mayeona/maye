import{_ as d,c as p,b as r,o as c}from"./app-B_sKV6fk.js";const e={};function a(m,t){return c(),p("div",null,[...t[0]||(t[0]=[r('<h2 id="序言" tabindex="-1"><a class="header-anchor" href="#序言"><span>序言</span></a></h2><p>通常在 Windows 上查看分析 tcp 协议会使用 wireshark，但 Linux 上一般使用 tcpdump. deepin 上使用<code>apt-get install tcpdump</code>安装命令。如果提示权限不足，使用<code>sudo</code>提权。</p><h2 id="_1-tcpdump-常用的参数" tabindex="-1"><a class="header-anchor" href="#_1-tcpdump-常用的参数"><span>1. tcpdump 常用的参数</span></a></h2><table><thead><tr><th>参数</th><th>释义</th><th>示例</th><th>备注</th></tr></thead><tbody><tr><td>host</td><td>基于 host 过滤</td><td>tcpdump host 127.0.0.1</td><td></td></tr><tr><td>src</td><td>基于源过滤</td><td>tcpdump src 127.0.0.1</td><td></td></tr><tr><td>dst</td><td>基于目的地过滤</td><td>tcpdump dst 127.0.0.1</td><td></td></tr><tr><td>net</td><td>基于网段过滤</td><td>tcpdump net 1192.168.31.0/24</td><td>同样可以指定源和目的 tcpdump [src\\dst] net 192.168.31.0/24</td></tr><tr><td>port</td><td>基于端口过滤</td><td>tcpdump tcp port 80</td><td>加上具体的协议 tcp 可以更精准的捕获。同样可以指定源和目的 tcpdump [src\\dst] port 80。如果要指定多个端口 tcpdump port 80 or port 22 或 tcpdump port 80 or 22。如果要抓去一个端口范围 tcpdump portrange 8000-8080。对于一些常见的协议可以使用协议名如 tcpdump tcp port http</td></tr><tr><td>icmp</td><td>基于协议过滤</td><td>tcpdump icmp</td><td>一般常用的协议，如 ip, ip6, arp, icmp, udp 等。但 http, dns, https, ssh 等应用层协议不能直接这样写，需要写成 tcpdump port http 或 tcpdump port 53(dns)。</td></tr><tr><td>-i</td><td>指定监听网络接口</td><td>tcpdump -i eht0</td><td>未指定时，默认监听第一块网卡上通过的数据包。tcpdump -i any 监听所有网卡，用来查看是否有网络流量。</td></tr><tr><td>-w</td><td>将捕获的信息保存到文件中</td><td>tcpdump -i eth0 -w a.pcap</td><td>不分析和打印到屏幕，导出文件为 cap 或 pcap 格式，可以直接使用 wireshark 打开，进行报文分析。</td></tr><tr><td>-r</td><td>从文件中读取数据</td><td>tcpdump -r a.pcap</td><td>读取后可以使用上述语法进行过滤分析</td></tr><tr><td>-n</td><td>直接显示 ip</td><td>tcpdump -n</td><td>避免执行 dns lookups 解析为主机名，速度会快很多。但端口还是会翻译为协议名</td></tr><tr><td>-nn</td><td>不把协议和端口转化成名字</td><td>tcpdump -nn</td><td>速度会快很多</td></tr><tr><td>-N</td><td>不打印 host 域名部分内容</td><td>tcpdump -N</td><td>如 192.168.10.135.12345 会被简化为 192.12345</td></tr><tr><td>-t</td><td>不输出时间</td><td>tcpdump -t</td><td></td></tr><tr><td>-tt</td><td>输出显示为时间戳</td><td>tcpdump -tt</td><td></td></tr><tr><td>-ttt</td><td>输出每两行打印的时间间隔</td><td>tcpdump -ttt</td><td>单位：毫秒</td></tr><tr><td>-tttt</td><td>在时间戳之前输出日期</td><td>tcpdump -tttt</td><td>输出的时间最直观</td></tr><tr><td>-v</td><td>详细输出</td><td>tcpdump -v</td><td></td></tr><tr><td>-vv</td><td>更详细输出</td><td>tcpdump -vv</td><td></td></tr><tr><td>-vvv</td><td>更更详细输出</td><td>tcpdump -vvv</td><td></td></tr><tr><td>-c</td><td>指定抓包数量</td><td>tcpdump -c 20</td><td>抓满20包个停止</td></tr><tr><td>-C</td><td>文件分割</td><td>tcpdump -C 1 -W 3 -w a.pcap</td><td>-C 与 -w 一起使用，数据在写入文件前检查是否超过了file_size(这里是1百万个字节)，单位是百万字节 1000000 个字节，超过后会自动写入新文件，文件名为 a.pcap1,a.pcap2 ... -W 表示最多写 3 个文件。</td></tr><tr><td>-Q</td><td>过滤数据包的方向</td><td>tcpdump -Q in\\out\\inout</td><td>不写和 inout 一样双向的。-Q 也可以用 --direction 等价代替</td></tr><tr><td>-q</td><td>简洁打印</td><td>tcpdump -q</td><td></td></tr><tr><td>-D</td><td>显示所有可用网卡</td><td>tcpdump -D</td><td></td></tr><tr><td>-L</td><td>列出网卡的已知数据链路</td><td>tcpdump -L</td><td></td></tr><tr><td>-s</td><td>指定捕获包的长度</td><td>tcpdump -s 20</td><td>单位是 byte，默认是 262144 个 byte。如果超过了大小，显示就会被截断，而打印出[</td></tr><tr><td>-A</td><td>以 ASCII 格式打印所有分组数据</td><td>tcpdump -A</td><td>这样方便使用 grep 等工具解析输出内容。例如：tcpdump -A</td></tr><tr><td>-X</td><td>同时使用十六进制和 ASCII 字符串打印报文</td><td>tcpdump -X</td><td>-X 和 -A 不能一起用</td></tr><tr><td>-e</td><td>打印出数据链路层的头部信息</td><td>tcpdump -e</td><td>如显示源和目的 MAC 地址，及 WLAN tag 信息</td></tr><tr><td>-F</td><td>使用指定文件(filter_rule)中的表达式抓包</td><td>tcpdump -F filter_rule</td><td>此时命令行后输入的规则将被忽略,这种情况适合表达式长期维护</td></tr><tr><td>-l</td><td>对标准输出进行缓冲</td><td>tcpdump -l</td><td>使标准输出设备遇到换行符时就讲这行内容打印出来，这在观察输出的同时写入文件很有用。如：tcpdump -l</td></tr><tr><td>less</td><td>基于包大小进行过滤</td><td>tcpdump less 32</td><td>抓取小于 32 个 byte 的数据包</td></tr><tr><td>greater</td><td>基于包大小进行过滤</td><td>tcpdump greater 50</td><td>抓取大于 100 个 byte 的数据包</td></tr><tr><td>-v</td><td>查看版本</td><td>tcpdump -v</td><td></td></tr></tbody></table><p>tcpdump 帮助命令<code>man tcpdump</code>, 使用<code>quit</code>退出。</p><h2 id="_2-tcp-协议分析" tabindex="-1"><a class="header-anchor" href="#_2-tcp-协议分析"><span>2. tcp 协议分析</span></a></h2><p>逻辑运算符：and(&amp;&amp;) or(||) not(!)。and 优先级高于 or。多个过滤器组合时需要用到圆括号，但在 shell 中圆括号是特殊字符，需要用引号，如：tcpdump &quot;src 127.0.0.1 and (dst port 3306 or 22)&quot;</p><p>只抓 SYN 包 tcpdump &#39;tcp[tcpflags] = tcp-syn&#39; 抓 SYN 和 ACK tcpdump &#39;tcp[tcpflags]&#39;</p><p>注意，监听本机时应使用回环地址 lo。</p>',9)])])}const s=d(e,[["render",a]]),o=JSON.parse('{"path":"/article/pry9jhsz/","title":"tcpdump使用","lang":"zh-CN","frontmatter":{"title":"tcpdump使用","tags":["TCP","tcpdump","Go"],"categories":["TCP"],"createTime":"2022/10/06 21:53:08","permalink":"/article/pry9jhsz/"},"readingTime":{"minutes":4.23,"words":1269},"git":{"createdTime":1769985102000,"updatedTime":1769985102000,"contributors":[{"name":"Mayee","username":"Mayee","email":"may675154357@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/Mayee?v=4","url":"https://github.com/Mayee"}]},"filePathRelative":"blog/5.运维/3.tcpdump使用.md","headers":[],"categoryList":[{"id":"190c84","sort":5,"name":"运维"}]}');export{s as comp,o as data};
