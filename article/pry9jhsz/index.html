<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.26" /><meta name="theme" content="VuePress Theme Plume 1.0.0-rc.178" /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><link rel="icon" type="image/png" href="https://theme-plume.vuejs.press/favicon-32x32.png"><title>tcpdump使用 | Mayee</title><meta name="description" content="Mayee 的笔记"><link rel="preload" href="/assets/style-KnDcgoSQ.css" as="style"><link rel="stylesheet" href="/assets/style-KnDcgoSQ.css"><link rel="modulepreload" href="/assets/app-B_sKV6fk.js"><link rel="modulepreload" href="/assets/index.html-vrDdiRv5.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-dd2ea341><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-99de49af></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-99de49af> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-dd2ea341 data-v-cbd59ece><div class="vp-navbar" vp-navbar data-v-cbd59ece data-v-00b38fa1><div class="wrapper" data-v-00b38fa1><div class="container" data-v-00b38fa1><div class="title" data-v-00b38fa1><div class="vp-navbar-title" data-v-00b38fa1 data-v-cd71b5f0><a class="vp-link link no-icon title" href="/" data-v-cd71b5f0><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-241acfce><!--]--><!--[--><img class="vp-image light logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-241acfce><!--]--><!--]--><!--]--><span data-v-cd71b5f0>Mayee</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-00b38fa1><div class="content-body" data-v-00b38fa1><!--[--><!--]--><div class="vp-navbar-search search" data-v-00b38fa1><div class="search-wrapper" data-v-86f05120><!----><div id="local-search" data-v-86f05120><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-86f05120><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><!--[--><!--]--><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-00b38fa1 data-v-56ee30cd><span id="main-nav-aria-label" class="visually-hidden" data-v-56ee30cd>Main Navigation</span><!--[--><!--[--><a class="vp-link link navbar-menu-link" href="/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>首页</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/blog/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>博客</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/article/categories/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>分类</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/article/tags/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>标签</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/article/archives/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>归档</span><!----><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-56ee30cd data-v-212729cc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-212729cc><span class="text" data-v-212729cc><!----><!----><span data-v-212729cc>笔记</span><!----><span class="vpi-chevron-down text-icon" data-v-212729cc></span></span></button><div class="menu" data-v-212729cc><div class="vp-menu" data-v-212729cc data-v-f7ab74ab><div class="items" data-v-f7ab74ab><!--[--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/10fywd94/" data-v-d3958394><!--[--><!----> 随手记 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/qr0e6712/" data-v-d3958394><!--[--><!----> Docker <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/q5w629t0/" data-v-d3958394><!--[--><!----> KMS <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/vej2ba8o/" data-v-d3958394><!--[--><!----> 开发环境 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/command/" data-v-d3958394><!--[--><!----> 常用命令 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/interview/" data-v-d3958394><!--[--><!----> 面试指南 <!----><!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!--[--><!--]--><!----><div class="vp-navbar-appearance appearance" data-v-00b38fa1 data-v-9942ed5a><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-9942ed5a data-v-9be4d56f data-v-ed16d483><span class="check" data-v-ed16d483><span class="icon" data-v-ed16d483><!--[--><span class="vpi-sun sun" data-v-9be4d56f></span><span class="vpi-moon moon" data-v-9be4d56f></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-00b38fa1 data-v-b1d2f84c data-v-c9db0fe8><!--[--><a class="vp-social-link no-icon" href="https://github.com/mayeona" aria-label="github" target="_blank" rel="noopener" data-v-c9db0fe8 data-v-bdde1d39><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-00b38fa1 data-v-155bedae data-v-212729cc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-212729cc><span class="vpi-more-horizontal icon" data-v-212729cc></span></button><div class="menu" data-v-212729cc><div class="vp-menu" data-v-212729cc data-v-f7ab74ab><!----><!--[--><!--[--><!----><div class="group" data-v-155bedae><div class="item appearance" data-v-155bedae><p class="label" data-v-155bedae>外观</p><div class="appearance-action" data-v-155bedae><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-155bedae data-v-9be4d56f data-v-ed16d483><span class="check" data-v-ed16d483><span class="icon" data-v-ed16d483><!--[--><span class="vpi-sun sun" data-v-9be4d56f></span><span class="vpi-moon moon" data-v-9be4d56f></span><!--]--></span></span></button></div></div></div><div class="group" data-v-155bedae><div class="item social-links" data-v-155bedae><div class="vp-social-links social-links-list" data-v-155bedae data-v-c9db0fe8><!--[--><a class="vp-social-link no-icon" href="https://github.com/mayeona" aria-label="github" target="_blank" rel="noopener" data-v-c9db0fe8 data-v-bdde1d39><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-00b38fa1 data-v-a432f868><span class="container" data-v-a432f868><span class="top" data-v-a432f868></span><span class="middle" data-v-a432f868></span><span class="bottom" data-v-a432f868></span></span></button></div></div></div></div><div class="divider" data-v-00b38fa1><div class="divider-line" data-v-00b38fa1></div></div></div><!----></header><!----><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-dd2ea341 data-v-631f6a1b><div class="vp-doc-container is-posts" data-v-631f6a1b data-v-5e118bb0><!--[--><!--]--><div class="container" data-v-5e118bb0><!----><div class="content" data-v-5e118bb0><div class="content-container" data-v-5e118bb0><!--[--><!--]--><main class="main" data-v-5e118bb0><nav class="vp-breadcrumb" data-v-5e118bb0 data-v-4d9bdc00><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-4d9bdc00><!--[--><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb" href="/" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-4d9bdc00></span><meta property="name" content="首页" data-v-4d9bdc00><meta property="position" content="1" data-v-4d9bdc00></li><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-4d9bdc00></span><meta property="name" content="博客" data-v-4d9bdc00><meta property="position" content="2" data-v-4d9bdc00></li><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb" href="/article/categories/?id=190c84" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->运维<!--]--><!----></a><span class="vpi-chevron-right" data-v-4d9bdc00></span><meta property="name" content="运维" data-v-4d9bdc00><meta property="position" content="3" data-v-4d9bdc00></li><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb current" href="/article/pry9jhsz/" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->tcpdump使用<!--]--><!----></a><!----><meta property="name" content="tcpdump使用" data-v-4d9bdc00><meta property="position" content="4" data-v-4d9bdc00></li><!--]--></ol></nav><!--[--><!--]--><!--[--><div class="vp-doc-title" data-v-403b82e6><!--[--><!--]--><h1 class="page-title" data-v-403b82e6><!----> tcpdump使用 <!----></h1><!--[--><!--]--></div><div class="vp-doc-meta" data-v-403b82e6><!--[--><!--]--><p class="reading-time" data-v-403b82e6><span class="vpi-books icon" data-v-403b82e6></span><span data-v-403b82e6>约 1269 字</span><span data-v-403b82e6>大约 4 分钟</span></p><p data-v-403b82e6><span class="vpi-tag icon" data-v-403b82e6></span><!--[--><a class="vp-link link tag vp-tag-akv7" href="/article/tags/?tag=TCP" data-v-403b82e6><!--[-->TCP<!--]--><!----></a><a class="vp-link link tag vp-tag-ilvv" href="/article/tags/?tag=tcpdump" data-v-403b82e6><!--[-->tcpdump<!--]--><!----></a><a class="vp-link link tag vp-tag-xj0o" href="/article/tags/?tag=Go" data-v-403b82e6><!--[-->Go<!--]--><!----></a><!--]--></p><!--[--><!--]--><p class="create-time" data-v-403b82e6><span class="vpi-clock icon" data-v-403b82e6></span><span data-v-403b82e6>2022-10-06</span></p></div><!--]--><!--[--><!--]--><div class="_article_pry9jhsz_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-5e118bb0><!--[--><!--]--><div data-v-5e118bb0><h2 id="序言" tabindex="-1"><a class="header-anchor" href="#序言"><span>序言</span></a></h2><p>通常在 Windows 上查看分析 tcp 协议会使用 wireshark，但 Linux 上一般使用 tcpdump. deepin 上使用<code>apt-get install tcpdump</code>安装命令。如果提示权限不足，使用<code>sudo</code>提权。</p><h2 id="_1-tcpdump-常用的参数" tabindex="-1"><a class="header-anchor" href="#_1-tcpdump-常用的参数"><span>1. tcpdump 常用的参数</span></a></h2><table><thead><tr><th>参数</th><th>释义</th><th>示例</th><th>备注</th></tr></thead><tbody><tr><td>host</td><td>基于 host 过滤</td><td>tcpdump host 127.0.0.1</td><td></td></tr><tr><td>src</td><td>基于源过滤</td><td>tcpdump src 127.0.0.1</td><td></td></tr><tr><td>dst</td><td>基于目的地过滤</td><td>tcpdump dst 127.0.0.1</td><td></td></tr><tr><td>net</td><td>基于网段过滤</td><td>tcpdump net 1192.168.31.0/24</td><td>同样可以指定源和目的 tcpdump [src\dst] net 192.168.31.0/24</td></tr><tr><td>port</td><td>基于端口过滤</td><td>tcpdump tcp port 80</td><td>加上具体的协议 tcp 可以更精准的捕获。同样可以指定源和目的 tcpdump [src\dst] port 80。如果要指定多个端口 tcpdump port 80 or port 22 或 tcpdump port 80 or 22。如果要抓去一个端口范围 tcpdump portrange 8000-8080。对于一些常见的协议可以使用协议名如 tcpdump tcp port http</td></tr><tr><td>icmp</td><td>基于协议过滤</td><td>tcpdump icmp</td><td>一般常用的协议，如 ip, ip6, arp, icmp, udp 等。但 http, dns, https, ssh 等应用层协议不能直接这样写，需要写成 tcpdump port http 或 tcpdump port 53(dns)。</td></tr><tr><td>-i</td><td>指定监听网络接口</td><td>tcpdump -i eht0</td><td>未指定时，默认监听第一块网卡上通过的数据包。tcpdump -i any 监听所有网卡，用来查看是否有网络流量。</td></tr><tr><td>-w</td><td>将捕获的信息保存到文件中</td><td>tcpdump -i eth0 -w a.pcap</td><td>不分析和打印到屏幕，导出文件为 cap 或 pcap 格式，可以直接使用 wireshark 打开，进行报文分析。</td></tr><tr><td>-r</td><td>从文件中读取数据</td><td>tcpdump -r a.pcap</td><td>读取后可以使用上述语法进行过滤分析</td></tr><tr><td>-n</td><td>直接显示 ip</td><td>tcpdump -n</td><td>避免执行 dns lookups 解析为主机名，速度会快很多。但端口还是会翻译为协议名</td></tr><tr><td>-nn</td><td>不把协议和端口转化成名字</td><td>tcpdump -nn</td><td>速度会快很多</td></tr><tr><td>-N</td><td>不打印 host 域名部分内容</td><td>tcpdump -N</td><td>如 192.168.10.135.12345 会被简化为 192.12345</td></tr><tr><td>-t</td><td>不输出时间</td><td>tcpdump -t</td><td></td></tr><tr><td>-tt</td><td>输出显示为时间戳</td><td>tcpdump -tt</td><td></td></tr><tr><td>-ttt</td><td>输出每两行打印的时间间隔</td><td>tcpdump -ttt</td><td>单位：毫秒</td></tr><tr><td>-tttt</td><td>在时间戳之前输出日期</td><td>tcpdump -tttt</td><td>输出的时间最直观</td></tr><tr><td>-v</td><td>详细输出</td><td>tcpdump -v</td><td></td></tr><tr><td>-vv</td><td>更详细输出</td><td>tcpdump -vv</td><td></td></tr><tr><td>-vvv</td><td>更更详细输出</td><td>tcpdump -vvv</td><td></td></tr><tr><td>-c</td><td>指定抓包数量</td><td>tcpdump -c 20</td><td>抓满20包个停止</td></tr><tr><td>-C</td><td>文件分割</td><td>tcpdump -C 1 -W 3 -w a.pcap</td><td>-C 与 -w 一起使用，数据在写入文件前检查是否超过了file_size(这里是1百万个字节)，单位是百万字节 1000000 个字节，超过后会自动写入新文件，文件名为 a.pcap1,a.pcap2 ... -W 表示最多写 3 个文件。</td></tr><tr><td>-Q</td><td>过滤数据包的方向</td><td>tcpdump -Q in\out\inout</td><td>不写和 inout 一样双向的。-Q 也可以用 --direction 等价代替</td></tr><tr><td>-q</td><td>简洁打印</td><td>tcpdump -q</td><td></td></tr><tr><td>-D</td><td>显示所有可用网卡</td><td>tcpdump -D</td><td></td></tr><tr><td>-L</td><td>列出网卡的已知数据链路</td><td>tcpdump -L</td><td></td></tr><tr><td>-s</td><td>指定捕获包的长度</td><td>tcpdump -s 20</td><td>单位是 byte，默认是 262144 个 byte。如果超过了大小，显示就会被截断，而打印出[</td></tr><tr><td>-A</td><td>以 ASCII 格式打印所有分组数据</td><td>tcpdump -A</td><td>这样方便使用 grep 等工具解析输出内容。例如：tcpdump -A</td></tr><tr><td>-X</td><td>同时使用十六进制和 ASCII 字符串打印报文</td><td>tcpdump -X</td><td>-X 和 -A 不能一起用</td></tr><tr><td>-e</td><td>打印出数据链路层的头部信息</td><td>tcpdump -e</td><td>如显示源和目的 MAC 地址，及 WLAN tag 信息</td></tr><tr><td>-F</td><td>使用指定文件(filter_rule)中的表达式抓包</td><td>tcpdump -F filter_rule</td><td>此时命令行后输入的规则将被忽略,这种情况适合表达式长期维护</td></tr><tr><td>-l</td><td>对标准输出进行缓冲</td><td>tcpdump -l</td><td>使标准输出设备遇到换行符时就讲这行内容打印出来，这在观察输出的同时写入文件很有用。如：tcpdump -l</td></tr><tr><td>less</td><td>基于包大小进行过滤</td><td>tcpdump less 32</td><td>抓取小于 32 个 byte 的数据包</td></tr><tr><td>greater</td><td>基于包大小进行过滤</td><td>tcpdump greater 50</td><td>抓取大于 100 个 byte 的数据包</td></tr><tr><td>-v</td><td>查看版本</td><td>tcpdump -v</td><td></td></tr></tbody></table><p>tcpdump 帮助命令<code>man tcpdump</code>, 使用<code>quit</code>退出。</p><h2 id="_2-tcp-协议分析" tabindex="-1"><a class="header-anchor" href="#_2-tcp-协议分析"><span>2. tcp 协议分析</span></a></h2><p>逻辑运算符：and(&amp;&amp;) or(||) not(!)。and 优先级高于 or。多个过滤器组合时需要用到圆括号，但在 shell 中圆括号是特殊字符，需要用引号，如：tcpdump &quot;src 127.0.0.1 and (dst port 3306 or 22)&quot;</p><p>只抓 SYN 包 tcpdump &#39;tcp[tcpflags] = tcp-syn&#39; 抓 SYN 和 ACK tcpdump &#39;tcp[tcpflags]&#39;</p><p>注意，监听本机时应使用回环地址 lo。</p></div><!----><!----><div class="vp-doc-copyright" data-v-5e118bb0><h2 id="doc-copyright" tabindex="-1" class="vp-doc-header" data-v-53b95284><a href="#doc-copyright" class="header-anchor" data-v-53b95284><span data-v-53b95284><!--[-->版权所有<!--]--></span></a></h2><div class="hint-container tip copyright-container" data-v-79711e76><p data-v-79711e76><span data-v-79711e76>版权归属：</span><a class="vp-link link no-icon" href="https://github.com/Mayee" target="_blank" rel="noreferrer" data-v-79711e76><!--[-->Mayee<!--]--><!----></a></p><!----><p data-v-79711e76><span data-v-79711e76>许可证：</span><a class="vp-link link no-icon" href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noreferrer" data-v-79711e76><!--[-->署名 4.0 国际 (CC-BY-4.0)<!--]--><!----></a><!--[--><span class="vpi-license-cc" data-v-79711e76></span><span class="vpi-license-by" data-v-79711e76></span><!--]--></p></div></div></div></main><footer class="vp-doc-footer" data-v-5e118bb0 data-v-3078abbd><!--[--><!--]--><!----><div class="contributors" aria-label="Contributors" data-v-3078abbd><span class="contributors-label" data-v-3078abbd>贡献者: </span><span class="contributors-info" data-v-3078abbd><!--[--><!--[--><span class="contributor" data-v-3078abbd>Mayee</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-3078abbd><div class="pager" data-v-3078abbd><a class="vp-link link pager-link prev" href="/article/z0kyxi1y/" data-v-3078abbd><!--[--><span class="desc" data-v-3078abbd>上一页</span><span class="title" data-v-3078abbd><!----><span data-v-3078abbd>Netty实现TCP和Websocket服务端</span></span><!--]--><!----></a></div><div class="pager" data-v-3078abbd><a class="vp-link link pager-link next" href="/article/1ieb0ybp/" data-v-3078abbd><!--[--><span class="desc" data-v-3078abbd>下一页</span><span class="title" data-v-3078abbd><!----><span data-v-3078abbd>Go实现队列</span></span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button type="button" class="vp-back-to-top" aria-label="back to top" data-v-dd2ea341 style="display:none;" data-v-d4e26b45><span class="percent" data-allow-mismatch data-v-d4e26b45>0%</span><span class="show icon vpi-back-to-top" data-v-d4e26b45></span><svg aria-hidden="true" data-v-d4e26b45><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-d4e26b45></circle></svg></button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="sign down" class="vp-sign-down" aria-hidden="true" data-v-dd2ea341 style="display:none;" data-v-2a7cf2ea><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" data-v-2a7cf2ea><path d="m19 11l-7 6l-7-6" data-v-2a7cf2ea></path><path d="m19 5l-7 6l-7-6" opacity="0.6" data-v-2a7cf2ea></path></g></svg><footer class="vp-footer" vp-footer data-v-dd2ea341 data-v-b55ba299><!--[--><div class="container" data-v-b55ba299><!----><p class="copyright" data-v-b55ba299>©2021 Mayee</p></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-B_sKV6fk.js" defer></script></body></html>