<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.26" /><meta name="theme" content="VuePress Theme Plume 1.0.0-rc.178" /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><link rel="icon" type="image/png" href="https://theme-plume.vuejs.press/favicon-32x32.png"><title>各代码平台仓库同步 | Mayee</title><meta name="description" content="Mayee 的笔记"><link rel="preload" href="/assets/style-KnDcgoSQ.css" as="style"><link rel="stylesheet" href="/assets/style-KnDcgoSQ.css"><link rel="modulepreload" href="/assets/app-B_sKV6fk.js"><link rel="modulepreload" href="/assets/index.html-BMcmkJx3.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-dd2ea341><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-99de49af></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-99de49af> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-dd2ea341 data-v-cbd59ece><div class="vp-navbar" vp-navbar data-v-cbd59ece data-v-00b38fa1><div class="wrapper" data-v-00b38fa1><div class="container" data-v-00b38fa1><div class="title" data-v-00b38fa1><div class="vp-navbar-title" data-v-00b38fa1 data-v-cd71b5f0><a class="vp-link link no-icon title" href="/" data-v-cd71b5f0><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-241acfce><!--]--><!--[--><img class="vp-image light logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-241acfce><!--]--><!--]--><!--]--><span data-v-cd71b5f0>Mayee</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-00b38fa1><div class="content-body" data-v-00b38fa1><!--[--><!--]--><div class="vp-navbar-search search" data-v-00b38fa1><div class="search-wrapper" data-v-86f05120><!----><div id="local-search" data-v-86f05120><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-86f05120><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><!--[--><!--]--><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-00b38fa1 data-v-56ee30cd><span id="main-nav-aria-label" class="visually-hidden" data-v-56ee30cd>Main Navigation</span><!--[--><!--[--><a class="vp-link link navbar-menu-link" href="/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>首页</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/blog/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>博客</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/article/categories/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>分类</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/article/tags/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>标签</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/article/archives/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>归档</span><!----><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-56ee30cd data-v-212729cc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-212729cc><span class="text" data-v-212729cc><!----><!----><span data-v-212729cc>笔记</span><!----><span class="vpi-chevron-down text-icon" data-v-212729cc></span></span></button><div class="menu" data-v-212729cc><div class="vp-menu" data-v-212729cc data-v-f7ab74ab><div class="items" data-v-f7ab74ab><!--[--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/10fywd94/" data-v-d3958394><!--[--><!----> 随手记 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/qr0e6712/" data-v-d3958394><!--[--><!----> Docker <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/q5w629t0/" data-v-d3958394><!--[--><!----> KMS <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/vej2ba8o/" data-v-d3958394><!--[--><!----> 开发环境 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/command/" data-v-d3958394><!--[--><!----> 常用命令 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/interview/" data-v-d3958394><!--[--><!----> 面试指南 <!----><!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!--[--><!--]--><!----><div class="vp-navbar-appearance appearance" data-v-00b38fa1 data-v-9942ed5a><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-9942ed5a data-v-9be4d56f data-v-ed16d483><span class="check" data-v-ed16d483><span class="icon" data-v-ed16d483><!--[--><span class="vpi-sun sun" data-v-9be4d56f></span><span class="vpi-moon moon" data-v-9be4d56f></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-00b38fa1 data-v-b1d2f84c data-v-c9db0fe8><!--[--><a class="vp-social-link no-icon" href="https://github.com/mayeona" aria-label="github" target="_blank" rel="noopener" data-v-c9db0fe8 data-v-bdde1d39><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-00b38fa1 data-v-155bedae data-v-212729cc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-212729cc><span class="vpi-more-horizontal icon" data-v-212729cc></span></button><div class="menu" data-v-212729cc><div class="vp-menu" data-v-212729cc data-v-f7ab74ab><!----><!--[--><!--[--><!----><div class="group" data-v-155bedae><div class="item appearance" data-v-155bedae><p class="label" data-v-155bedae>外观</p><div class="appearance-action" data-v-155bedae><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-155bedae data-v-9be4d56f data-v-ed16d483><span class="check" data-v-ed16d483><span class="icon" data-v-ed16d483><!--[--><span class="vpi-sun sun" data-v-9be4d56f></span><span class="vpi-moon moon" data-v-9be4d56f></span><!--]--></span></span></button></div></div></div><div class="group" data-v-155bedae><div class="item social-links" data-v-155bedae><div class="vp-social-links social-links-list" data-v-155bedae data-v-c9db0fe8><!--[--><a class="vp-social-link no-icon" href="https://github.com/mayeona" aria-label="github" target="_blank" rel="noopener" data-v-c9db0fe8 data-v-bdde1d39><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-00b38fa1 data-v-a432f868><span class="container" data-v-a432f868><span class="top" data-v-a432f868></span><span class="middle" data-v-a432f868></span><span class="bottom" data-v-a432f868></span></span></button></div></div></div></div><div class="divider" data-v-00b38fa1><div class="divider-line" data-v-00b38fa1></div></div></div><!----></header><!----><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-dd2ea341 data-v-631f6a1b><div class="vp-doc-container is-posts" data-v-631f6a1b data-v-5e118bb0><!--[--><!--]--><div class="container" data-v-5e118bb0><!----><div class="content" data-v-5e118bb0><div class="content-container" data-v-5e118bb0><!--[--><!--]--><main class="main" data-v-5e118bb0><nav class="vp-breadcrumb" data-v-5e118bb0 data-v-4d9bdc00><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-4d9bdc00><!--[--><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb" href="/" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-4d9bdc00></span><meta property="name" content="首页" data-v-4d9bdc00><meta property="position" content="1" data-v-4d9bdc00></li><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-4d9bdc00></span><meta property="name" content="博客" data-v-4d9bdc00><meta property="position" content="2" data-v-4d9bdc00></li><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb" href="/article/categories/?id=867696" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->其他<!--]--><!----></a><span class="vpi-chevron-right" data-v-4d9bdc00></span><meta property="name" content="其他" data-v-4d9bdc00><meta property="position" content="3" data-v-4d9bdc00></li><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb current" href="/article/26ytrk59/" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->各代码平台仓库同步<!--]--><!----></a><!----><meta property="name" content="各代码平台仓库同步" data-v-4d9bdc00><meta property="position" content="4" data-v-4d9bdc00></li><!--]--></ol></nav><!--[--><!--]--><!--[--><div class="vp-doc-title" data-v-403b82e6><!--[--><!--]--><h1 class="page-title" data-v-403b82e6><!----> 各代码平台仓库同步 <!----></h1><!--[--><!--]--></div><div class="vp-doc-meta" data-v-403b82e6><!--[--><!--]--><p class="reading-time" data-v-403b82e6><span class="vpi-books icon" data-v-403b82e6></span><span data-v-403b82e6>约 3352 字</span><span data-v-403b82e6>大约 11 分钟</span></p><p data-v-403b82e6><span class="vpi-tag icon" data-v-403b82e6></span><!--[--><a class="vp-link link tag vp-tag-nqac" href="/article/tags/?tag=GitHub" data-v-403b82e6><!--[-->GitHub<!--]--><!----></a><a class="vp-link link tag vp-tag-tvlr" href="/article/tags/?tag=GitLab" data-v-403b82e6><!--[-->GitLab<!--]--><!----></a><a class="vp-link link tag vp-tag-sleq" href="/article/tags/?tag=Gitee" data-v-403b82e6><!--[-->Gitee<!--]--><!----></a><!--]--></p><!--[--><!--]--><p class="create-time" data-v-403b82e6><span class="vpi-clock icon" data-v-403b82e6></span><span data-v-403b82e6>2023-11-04</span></p></div><!--]--><!--[--><!--]--><div class="_article_26ytrk59_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-5e118bb0><!--[--><!--]--><div data-v-5e118bb0><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>这两天 Github 开源界发生了几件大事：</p><ul><li>Clash_for_windows 的作者宣布停更，原因不详；</li><li>Clash 内核作者删库，原因不详；</li><li><strong>我的账号被封</strong>，原因不详；</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/suspended.5gl47o7oq8w0.webp" alt="suspended"></p><p>这可把我难受的，虽然我那仓库中的代码对开源没啥贡献，但好歹也是我从学习到工作，一步步趟过来的，承载了不少的记忆。</p><p><strong>拥有的时候从不在意，失去之后追悔莫及。</strong></p><p>不过好在之前有一部分代码放在了 Gitee 上，本地仓库也有一部分代码，大约有 95% 的仓库还能恢复，恢复不了的只能算了，毕竟记忆也不都是完整的，损失尚可接受。</p><p>这次号封的太突然了，事先连个邮件招呼都没有。搜索了下发现类似的情况还挺多。有尝试过找回，不过应该希望不大，好多人等了几个月最终也没有解封。</p><p>同样突然封号的事情在俄乌冲突期间也发生过，Github 当时封禁了很多俄罗斯的账号。虽说开源项目无国界，可平台政治有立场。</p><p>为了尽量避免突然封号导致的损失，将仓库代码同步到各个平台是多么重要的一件事，毕竟系统上线都还考虑异地容灾的问题。</p><h2 id="_1-选择平台" tabindex="-1"><a class="header-anchor" href="#_1-选择平台"><span>1. 选择平台</span></a></h2><p>当前代码版本控制主要使用到 Git ，而支持 Git 的主流平台大致有如下几个：</p><ul><li>国外平台：Github、Gitlab；</li><li>国内平台：Gitee、Coding、阿里云效、极狐Gitlab；</li></ul><p>最终我的选择是 Github、Gitlab 和 Gitee。</p><blockquote><p>这么选的理由是什么？</p></blockquote><p>首先，我的目标是要多个平台，且要包含国内和国外的平台。</p><ul><li>Github 的特点是拥有非常多的国内外开源项目，这是一定是要有的。</li><li>Gitlab 的特点是对代码分析，CI/CD 等方面的支持比较好，并且支持自建，企业内部使用比较多，多熟悉有好处。</li><li>Gitee 的特点是国内使用比较多，有挺多国内开源项目，访问方便且速度快。</li><li>Coding 和 阿里云效 主要做 saas 服务，小公司一般会选择使用，不是很必要。</li><li>极狐Gitlab 它拥有 Gitlab 的功能，又是国内平台，这两个特点相当于 Gitlab 和 Gitee，故不必选择。</li></ul><blockquote><p>这里说一下 Gitlab 和 极狐Gitlab 的联系。</p></blockquote><p>为积极响应国家“十四五规划和2035年远景目标纲要”指导精神，进一步推动中国开源、开放GitOps技术在各“产学研”领域的规范化实施和落地。 由红杉宽带跨境数字产业基金高成资本投资，成立极狐信息技术(湖北)有限公司，加上 Gitlab 官方授权的品牌技术加持，就是极狐Gitlab。 它的目标用户群体是中国大陆及港澳地区的开发者，由中国本地团队管理，服务器在中国大陆，数据中心和运营商在中国香港，因此极狐Gitlab 也被称为“中国版 Gitlab”。</p><p>OK，现在已经确定了要使用的平台，接下来就是琢磨怎么在这三个平台之间同步了。</p><h2 id="_2-同步模式" tabindex="-1"><a class="header-anchor" href="#_2-同步模式"><span>2. 同步模式</span></a></h2><p>首先要明确一点，同步是个什么需求。<code>同步</code>这个词的意思并不是很清晰，既可以指一次性同步，也可以指持续性同步。那么可以细化出两种理解：</p><ul><li>仓库导入(import)：这是一次性同步，表示将其他平台的仓库导入到当前平台中，即完成了一次同步。导入完成后，后续如果在原平台有更新，当前平台不会同步更新。</li><li>仓库镜像(mirror)：这表示目标仓库完全是源仓库的镜像，源仓库中有任何变化，都会反应在目标仓库中。也就是说如果在原平台有更新，当前平台也会同步更新。</li></ul><p>很明显，我们的需求是仓库镜像(mirror)。</p><p>这里再提一嘴，Gitee 和 Gitlab 的导入(import)功能都做挺好的，它们都支持在新建项目(仓库)时，选择导入，然后登录 Github 账号，批量选择需要导入的仓库，还可以选择私有仓库，一键导入非常方便。 而 Github 就稍显弱一点了，它只能通过 URL 导入，这自然就只能导入公开仓库了，私有仓库是访问不到的。</p><p>而仓库镜像(mirror)又有两种模式：</p><ul><li><code>push 模式</code>：把当前平台选定仓库中的代码推送到另一个平台选定的仓库中，在原仓库配置。Gitlab 和 Gitee 都支持这种模式。这个功能 Gitlab 是免费支持的，但 Gitee 是限时开放至 2023 年 12 月 31 日，届时会更新产品策略，不确定是否会变成付费功能。</li><li><code>pull 模式</code>：把另一个平台选定仓库中的代码拉取到当前平台选定的仓库中，在目标仓库和源仓库配置(Webhook)。当前仅 Gitee 支持这种模式，同样的是限时开放至 2023 年 12 月 31 日。</li></ul><p>而 Github 则不支持 push 模式，但可以通过配置 Webhook 实现 pull 模式，不过 Webhook 需要有额外的三方服务来支持处理 hook 请求，弄起来不是很方便，而且也不是非要这么做，所以这里就不细究了。</p><p>下面详细说说 push 和 poll 这两种模式。</p><h3 id="_2-1-push-模式" tabindex="-1"><a class="header-anchor" href="#_2-1-push-模式"><span>2.1 push 模式</span></a></h3><p>例如，我在 Gitlab 上创建了一个仓库<code>sync-repo</code>，我想把它导入到 Github 上，同时后续如果在 Gitlab 上有新的提交，Github 也会同步提交记录。</p><p>这里我在 Gitlab 仓库初始化时勾选了自描述文件，也就是会创建 README.md 文件。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/01_2.1_01.3c081hwrihy0.webp" alt="01_2"></p><p>仓库创建完成，<code>README.md</code>文件内容如下。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/01_2.1_02.1c1xicauclq8.webp" alt="01_2"></p><p>接下来在 Github 上也创建一个仓库<code>sync-repo</code>，但是不创建 README.md 文件，也就是一个空仓库不包含任何文件，因为一会我们要把 Gitlab 上的 README.md 文件同步过来。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.1_03.7ja9fszt8yo.webp" alt="02_2"></p><p>接着就需要在 Github 上创建一个私人令牌。 登录自己的 Github 账号之后，在主页右上角点击头像，选择<code>Settings</code>，然后在左侧菜单最底部选择<code>Developer settings</code>，再选择<code>Personal access tokens</code>，点击<code>Tokens(classic)</code>，接着点击<code>Generate new token</code>，选择<code>Generate new token(classic)</code>。 然后在弹出的对话框中填写<code>Note</code>，接着勾选<code>repo</code>，<code>Expiration</code>那里是选择 token 的有效期，这个看个人需求，如果没有特别需求，直接就<code>no expiration</code>即永不过期。 然后拉到最下面点击<code>Generate token</code>，就得到了一个私人令牌，格式为<code>ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code>。 注意这里生成的 token 只会显示一次，后续就看不到了，如果忘记了只能重新生成，所以最好把这个 token 复制下来，后面会多次用到。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.1_04.4ireuuj1gb60.webp" alt="02_2"></p><p>刚刚我们在 Github 上创建的仓库<code>sync-repo</code>，复制仓库 clone 地址<code>https://github.com/Ma-yeah/picx-images-hosting.git</code> ，注意选择 HTTPS 协议。 然后我们回到 Gitlab 平台的<code>sync-repo</code>中，在左侧菜单选择<code>设置</code>，然后选择<code>仓库</code>，接着展开<code>镜像仓库</code>一栏，添加新的。</p><p>要填写的地方有三个：</p><ul><li><code>Git 仓库 URL</code>：这里把刚刚复制的 Github 仓库 clone 地址粘贴过来，另外需要注意在<code>https://</code>后面加上你的 Github 用户名并用<code>@</code>分隔。这里我的用户名是<code>Ma-yeah</code>，所以最终需要填写的是<code>https://Ma-yeah@github.com/Ma-yeah/picx-images-hosting.git</code>；</li><li><code>用户名</code>：这里填写的是 Github 用户名，也就是<code>Ma-yeah</code>；</li><li><code>密码</code>：这里填写的是刚刚在 Github 上创建的私人令牌，也就是<code>ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code>。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.1_05.236oz36a9veo.webp" alt="02_2"></p><p>然后点击<code>镜像仓库</code>即为保存。这样一来我们就配置好了 Github 与 Gitlab 的关联，后续如果在 Gitlab 上有新的提交，Github 也会同步提交记录。 如果网络不好，自动同步可能会有一定的延迟或者失败，此时我们可以手动同步。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.1_06.5s35ozj5v5k0.webp" alt="02_2"></p><p>同步完成后，我们回到 Github 上的<code>sync-repo</code>仓库，可以看到已经同步过来了<code>README.md</code>文件。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.1_07.69m7pb2n3x00.webp" alt="02_2"></p><hr><p>另外，如果想把 Gitlab 的仓库同步到 Gitee 上，也是同样的操作。在 Gitee 的设置中，创建私人令牌。 之后在 Gitlab 中的操作就一模一样了，这里不再赘述。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.1_08.2wxvt7885ta0.webp" alt="02_2"></p><hr><p>如果想要把 Gitee 上的仓库同步到 Github 上就更简单了。 在 Gitee 上的指定仓库中，选择<code>设置</code> -&gt; <code>仓库镜像管理</code> -&gt; <code>添加镜像仓库</code>，登录了自己的 Github 账号之后，在<code>镜像仓库</code>中选定要同步到 Github 上的仓库，然后在<code>私人令牌</code>中填写上面的 Github 私人令牌，然后点击<code>添加</code>即可。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.1_09.1ms7dti6jejk.webp" alt="02_2"></p><hr><p>这种模式的好处在于，可以同步私有仓库，相当于你把自家(Github)钥匙(token)给别人(Gitlab/Gitee)了，而这把钥匙可以开你家(Github)大门(公开仓库)和你的卧室门(私有仓库)。 Gitlab/Gitee 随时可以拿这个令牌主动访问 Github 上的仓库。</p><h2 id="_2-2-pull-模式" tabindex="-1"><a class="header-anchor" href="#_2-2-pull-模式"><span>2.2 pull 模式</span></a></h2><p>这里 pull 模式只有 Gitee 支持。例如，当我们需要把 Github 上的仓库同步到 Gitee 上时，使用了 pull 模式。 需要注意的是，这种模式下，在创建 Github 私人令牌时，不用勾选<code>repo</code>，而是需要勾选<code>admin:repo_hook</code>授权，也就是允许 Gitee 去 Github 的仓库中创建 Webhook。</p><p>如果 Github 的令牌没有<code>admin:repo_hook</code>授权，那么就需要<a href="https://help.gitee.com/repository/settings/sync-between-gitee-github#%E5%A6%82%E4%BD%95%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE-Webhook" target="_blank" rel="noopener noreferrer">手动配置 Webhook</a>。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.2_01.2xuytxx44os0.webp" alt="02_2"></p><p>因为 pull 模式实际上是在 Github 中填写了一个 Webhook 链接，也就是当我们向 Github 提交了代码，就会触发 Webhook 向 Gitee 发送一个 POST 请求，而 Gitee 是有相应的服务来处理这个请求的。 Gitee 就会把 Github 对应仓库重新 clone 覆盖本平台仓库。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.2_02.45ml6r2nj3s0.webp" alt="02_2"></p><p>需要注意的是，实测发现 Gitee 的 pull 模式同步延迟比较大，不过终究是会自动触发。 另外，实测发现，如果 Gitee 的仓库设置为私有时，向 github 提交代码，Gitee 不会触发自动同步，这个时候手动执行<code>更新</code>即可同步。 在 Gitea(一个 Gitee 的开源版本)中，有过用户报告说私有仓库的 Webhook 存在<a href="https://github.com/go-gitea/gitea/issues/9412" target="_blank" rel="noopener noreferrer">自动触发问题</a>。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.2_03.53bgupv6n7o0.webp" alt="02_2"></p><p>Gitee 中的仓库镜像管理功能，在一个仓库中，只能存在一个 poll 的操作，但可以存在多个 push 的操作。 想想就可以知道为什么不能存在多个 poll 操作。因为多个源对同一个目标做覆盖(poll)这是无意义的，但可以把一个源推送(push)给多个目标，对于单个目标来说它们还是只有一个源，这并不冲突。</p><h3 id="_2-3-模式总结" tabindex="-1"><a class="header-anchor" href="#_2-3-模式总结"><span>2.3 模式总结</span></a></h3><p>值得注意的是，无论使用 push 模式还是 pull 模式，都会覆盖掉目标仓库，也就是每次触发都是全量更新的。 所以操作的时候千万要注意看清楚，别首次同步时搞错了仓库，把其他仓库的代码给覆盖了，那就找不回来了，除非你本地还有那个仓库的代码，再重新上传，否则就悲剧了，千万注意要做好备份。</p><h2 id="_3-同步方案" tabindex="-1"><a class="header-anchor" href="#_3-同步方案"><span>3. 同步方案</span></a></h2><p>通过上文的介绍，Github 原生不支持镜像仓库，所以不能直接向 Github 提交代码；Gitee 的镜像仓库只能与 Github 交互，但可以用 push 和 poll 模式；Gitlab 的镜像仓库公功能是通用的，但只能用 push 模式。 那么我们可以总结出如下几个同步方向：</p><ul><li>Gitlab -- push --&gt; Github</li><li>Gitlab -- push --&gt; Gitee</li><li>Gitee -- push --&gt; Github</li><li>Gitee &lt;-- pull -- Github</li></ul><p>当我们选择把代码提交到某一个平台，然后自动同步到其他平台，这个链路可以有三种：</p><ol><li>Gitlab -- push --&gt; Gitee -- push --&gt; Github</li><li>Gitlab -- push --&gt; Github -- pull --&gt; Gitee</li><li>Gitlab -- push --&gt; Github, Gitlab -- push --&gt; Gitee</li></ol><p>通过上文的介绍，由于 Gitee 的仓库镜像功能是限时的，到期是否会收费未可知，不应过于依赖，因此 Gitee 只适合放在链路的末尾，即随时可以剔除而不影响其他平台，所以方案 1 被排除。 又因为 Gtiee 对于私有仓库的 Webhook 存在自动触发问题，pull 模式使用会受限，所以方案 2 也被排除。</p><p>因此，我们最后选择方案 3，即始终向 Gtilab 提交代码，然后自动向 Github 和 Gitee 推送。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/2023-11-04/02_2.2_04.3zvioag5zl60.webp" alt="02_2"></p><h2 id="结语" tabindex="-1"><a class="header-anchor" href="#结语"><span>结语</span></a></h2><p>如此一来，Gitlab 中的所有仓库都可以设置为私有，不对外暴露，然后同步到 Github 和 Gitee 上的仓库可以选择性公开或私有，对外暴露。</p><hr><p>完结，撒花 ✿✿ヽ(°▽°)ノ✿</p></div><!----><!----><div class="vp-doc-copyright" data-v-5e118bb0><h2 id="doc-copyright" tabindex="-1" class="vp-doc-header" data-v-53b95284><a href="#doc-copyright" class="header-anchor" data-v-53b95284><span data-v-53b95284><!--[-->版权所有<!--]--></span></a></h2><div class="hint-container tip copyright-container" data-v-79711e76><p data-v-79711e76><span data-v-79711e76>版权归属：</span><a class="vp-link link no-icon" href="https://github.com/Mayee" target="_blank" rel="noreferrer" data-v-79711e76><!--[-->Mayee<!--]--><!----></a></p><!----><p data-v-79711e76><span data-v-79711e76>许可证：</span><a class="vp-link link no-icon" href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noreferrer" data-v-79711e76><!--[-->署名 4.0 国际 (CC-BY-4.0)<!--]--><!----></a><!--[--><span class="vpi-license-cc" data-v-79711e76></span><span class="vpi-license-by" data-v-79711e76></span><!--]--></p></div></div></div></main><footer class="vp-doc-footer" data-v-5e118bb0 data-v-3078abbd><!--[--><!--]--><!----><div class="contributors" aria-label="Contributors" data-v-3078abbd><span class="contributors-label" data-v-3078abbd>贡献者: </span><span class="contributors-info" data-v-3078abbd><!--[--><!--[--><span class="contributor" data-v-3078abbd>Mayee</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-3078abbd><div class="pager" data-v-3078abbd><a class="vp-link link pager-link prev" href="/article/ryxmiytl/" data-v-3078abbd><!--[--><span class="desc" data-v-3078abbd>上一页</span><span class="title" data-v-3078abbd><!----><span data-v-3078abbd>WSL2使用</span></span><!--]--><!----></a></div><div class="pager" data-v-3078abbd><a class="vp-link link pager-link next" href="/article/3ezimtov/" data-v-3078abbd><!--[--><span class="desc" data-v-3078abbd>下一页</span><span class="title" data-v-3078abbd><!----><span data-v-3078abbd>深入理解睡眠</span></span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button type="button" class="vp-back-to-top" aria-label="back to top" data-v-dd2ea341 style="display:none;" data-v-d4e26b45><span class="percent" data-allow-mismatch data-v-d4e26b45>0%</span><span class="show icon vpi-back-to-top" data-v-d4e26b45></span><svg aria-hidden="true" data-v-d4e26b45><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-d4e26b45></circle></svg></button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="sign down" class="vp-sign-down" aria-hidden="true" data-v-dd2ea341 style="display:none;" data-v-2a7cf2ea><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" data-v-2a7cf2ea><path d="m19 11l-7 6l-7-6" data-v-2a7cf2ea></path><path d="m19 5l-7 6l-7-6" opacity="0.6" data-v-2a7cf2ea></path></g></svg><footer class="vp-footer" vp-footer data-v-dd2ea341 data-v-b55ba299><!--[--><div class="container" data-v-b55ba299><!----><p class="copyright" data-v-b55ba299>©2021 Mayee</p></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-B_sKV6fk.js" defer></script></body></html>