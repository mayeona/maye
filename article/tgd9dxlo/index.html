<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.26" /><meta name="theme" content="VuePress Theme Plume 1.0.0-rc.178" /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><link rel="icon" type="image/png" href="https://theme-plume.vuejs.press/favicon-32x32.png"><title>ImmortalWrt系统使用 | Mayee</title><meta name="description" content="Mayee 的笔记"><link rel="preload" href="/assets/style-KnDcgoSQ.css" as="style"><link rel="stylesheet" href="/assets/style-KnDcgoSQ.css"><link rel="modulepreload" href="/assets/app-B_sKV6fk.js"><link rel="modulepreload" href="/assets/index.html-Cxm-COgy.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-dd2ea341><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-99de49af></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-99de49af> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-dd2ea341 data-v-cbd59ece><div class="vp-navbar" vp-navbar data-v-cbd59ece data-v-00b38fa1><div class="wrapper" data-v-00b38fa1><div class="container" data-v-00b38fa1><div class="title" data-v-00b38fa1><div class="vp-navbar-title" data-v-00b38fa1 data-v-cd71b5f0><a class="vp-link link no-icon title" href="/" data-v-cd71b5f0><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-241acfce><!--]--><!--[--><img class="vp-image light logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-241acfce><!--]--><!--]--><!--]--><span data-v-cd71b5f0>Mayee</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-00b38fa1><div class="content-body" data-v-00b38fa1><!--[--><!--]--><div class="vp-navbar-search search" data-v-00b38fa1><div class="search-wrapper" data-v-86f05120><!----><div id="local-search" data-v-86f05120><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-86f05120><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><!--[--><!--]--><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-00b38fa1 data-v-56ee30cd><span id="main-nav-aria-label" class="visually-hidden" data-v-56ee30cd>Main Navigation</span><!--[--><!--[--><a class="vp-link link navbar-menu-link" href="/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>首页</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/blog/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>博客</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/article/categories/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>分类</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/article/tags/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>标签</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/article/archives/" tabindex="0" data-v-56ee30cd data-v-e5935568><!--[--><!----><span data-v-e5935568>归档</span><!----><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-56ee30cd data-v-212729cc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-212729cc><span class="text" data-v-212729cc><!----><!----><span data-v-212729cc>笔记</span><!----><span class="vpi-chevron-down text-icon" data-v-212729cc></span></span></button><div class="menu" data-v-212729cc><div class="vp-menu" data-v-212729cc data-v-f7ab74ab><div class="items" data-v-f7ab74ab><!--[--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/10fywd94/" data-v-d3958394><!--[--><!----> 随手记 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/qr0e6712/" data-v-d3958394><!--[--><!----> Docker <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/q5w629t0/" data-v-d3958394><!--[--><!----> KMS <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/notes/vej2ba8o/" data-v-d3958394><!--[--><!----> 开发环境 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/command/" data-v-d3958394><!--[--><!----> 常用命令 <!----><!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-f7ab74ab data-v-d3958394><a class="vp-link link" href="/interview/" data-v-d3958394><!--[--><!----> 面试指南 <!----><!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!--[--><!--]--><!----><div class="vp-navbar-appearance appearance" data-v-00b38fa1 data-v-9942ed5a><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-9942ed5a data-v-9be4d56f data-v-ed16d483><span class="check" data-v-ed16d483><span class="icon" data-v-ed16d483><!--[--><span class="vpi-sun sun" data-v-9be4d56f></span><span class="vpi-moon moon" data-v-9be4d56f></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-00b38fa1 data-v-b1d2f84c data-v-c9db0fe8><!--[--><a class="vp-social-link no-icon" href="https://github.com/mayeona" aria-label="github" target="_blank" rel="noopener" data-v-c9db0fe8 data-v-bdde1d39><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-00b38fa1 data-v-155bedae data-v-212729cc><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-212729cc><span class="vpi-more-horizontal icon" data-v-212729cc></span></button><div class="menu" data-v-212729cc><div class="vp-menu" data-v-212729cc data-v-f7ab74ab><!----><!--[--><!--[--><!----><div class="group" data-v-155bedae><div class="item appearance" data-v-155bedae><p class="label" data-v-155bedae>外观</p><div class="appearance-action" data-v-155bedae><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-155bedae data-v-9be4d56f data-v-ed16d483><span class="check" data-v-ed16d483><span class="icon" data-v-ed16d483><!--[--><span class="vpi-sun sun" data-v-9be4d56f></span><span class="vpi-moon moon" data-v-9be4d56f></span><!--]--></span></span></button></div></div></div><div class="group" data-v-155bedae><div class="item social-links" data-v-155bedae><div class="vp-social-links social-links-list" data-v-155bedae data-v-c9db0fe8><!--[--><a class="vp-social-link no-icon" href="https://github.com/mayeona" aria-label="github" target="_blank" rel="noopener" data-v-c9db0fe8 data-v-bdde1d39><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-00b38fa1 data-v-a432f868><span class="container" data-v-a432f868><span class="top" data-v-a432f868></span><span class="middle" data-v-a432f868></span><span class="bottom" data-v-a432f868></span></span></button></div></div></div></div><div class="divider" data-v-00b38fa1><div class="divider-line" data-v-00b38fa1></div></div></div><!----></header><!----><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-dd2ea341 data-v-631f6a1b><div class="vp-doc-container is-posts" data-v-631f6a1b data-v-5e118bb0><!--[--><!--]--><div class="container" data-v-5e118bb0><!----><div class="content" data-v-5e118bb0><div class="content-container" data-v-5e118bb0><!--[--><!--]--><main class="main" data-v-5e118bb0><nav class="vp-breadcrumb" data-v-5e118bb0 data-v-4d9bdc00><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-4d9bdc00><!--[--><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb" href="/" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-4d9bdc00></span><meta property="name" content="首页" data-v-4d9bdc00><meta property="position" content="1" data-v-4d9bdc00></li><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-4d9bdc00></span><meta property="name" content="博客" data-v-4d9bdc00><meta property="position" content="2" data-v-4d9bdc00></li><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb" href="/article/categories/?id=dbc378" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->网络<!--]--><!----></a><span class="vpi-chevron-right" data-v-4d9bdc00></span><meta property="name" content="网络" data-v-4d9bdc00><meta property="position" content="3" data-v-4d9bdc00></li><li property="itemListElement" typeof="ListItem" data-v-4d9bdc00><a class="vp-link link breadcrumb current" href="/article/tgd9dxlo/" property="item" typeof="WebPage" data-v-4d9bdc00><!--[-->ImmortalWrt系统使用<!--]--><!----></a><!----><meta property="name" content="ImmortalWrt系统使用" data-v-4d9bdc00><meta property="position" content="4" data-v-4d9bdc00></li><!--]--></ol></nav><!--[--><!--]--><!--[--><div class="vp-doc-title" data-v-403b82e6><!--[--><!--]--><h1 class="page-title" data-v-403b82e6><!----> ImmortalWrt系统使用 <!----></h1><!--[--><!--]--></div><div class="vp-doc-meta" data-v-403b82e6><!--[--><!--]--><p class="reading-time" data-v-403b82e6><span class="vpi-books icon" data-v-403b82e6></span><span data-v-403b82e6>约 3576 字</span><span data-v-403b82e6>大约 12 分钟</span></p><p data-v-403b82e6><span class="vpi-tag icon" data-v-403b82e6></span><!--[--><a class="vp-link link tag vp-tag-ilvv" href="/article/tags/?tag=R2S" data-v-403b82e6><!--[-->R2S<!--]--><!----></a><a class="vp-link link tag vp-tag-heta" href="/article/tags/?tag=ImmortalWrt" data-v-403b82e6><!--[-->ImmortalWrt<!--]--><!----></a><!--]--></p><!--[--><!--]--><p class="create-time" data-v-403b82e6><span class="vpi-clock icon" data-v-403b82e6></span><span data-v-403b82e6>2025-02-11</span></p></div><!--]--><!--[--><!--]--><div class="_article_tgd9dxlo_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-5e118bb0><!--[--><!--]--><div data-v-5e118bb0><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>在上一篇文章<a class="vp-link link" href="/article/ajedbv3c/"><!--[-->家庭网络配置<!--]--><!----></a>中提到我的 R2S 刷了<a href="https://github.com/QiuSimons/YAOF" target="_blank" rel="noopener noreferrer">YAOF</a>的固件后，网速能跑带宽，猜测可能是<code>LAN</code>口与<code>WAN</code>口交换的缘故，而在后来的折腾中发现好像不是这样，可能单是因为<code>iStoreOS</code>的固件跑不满带宽。<br> 之所以有了这篇文章，是因为我需要在软路由的 Docker 中部署几个电视直播源(部署方式见<a class="vp-link link" href="/article/pqozqzh6/"><!--[-->电视直播相关汇总<!--]--><!----></a>)，但是 Docker 分区下的磁盘空间太小了，下载启动了两个容器就没空间了。于是在网上寻找<code>Docker分区扩容</code>的方法，其中有个简单的方式就是创建一个新分区，然后挂载路径为 Docker 根目录<code>/opt/docker</code>，但是操作完后没有达到预期效果，后来继续寻找方法，最终促使我将<code>YAOF</code>的固件替换为了<code>ImmortalWrt</code>的固件。实际上YAOF固件貌似也是基于ImmortalWrt固件编译的，选择YAOF就是拿来直接用，选择ImmortalWrt则更精简，便于自定义。</p><h2 id="_1-固件选择" tabindex="-1"><a class="header-anchor" href="#_1-固件选择"><span>1. 固件选择</span></a></h2><p><code>OpenWrt</code>是一个针对嵌入式设备的路由器系统(Linux操作系统)，常见固件：官方Openwrt、ImmortalWrt、Lean固件、iStoreOS等。<br> 官方OpenWrt在国外，软件包商店需要代理访问，而ImmortalWrt针对中国用户做了优化，软件包商店可直接访问，并且跟随官方更新。</p><p>固件下载地址：<a href="https://firmware-selector.openwrt.org/" target="_blank" rel="noopener noreferrer">OpenWrt</a>、<a href="https://firmware-selector.immortalwrt.org/" target="_blank" rel="noopener noreferrer">ImmortalWrt</a>。输入设备型号搜索(如：R2S)，然后下载固件即可，这里我选择的是 ImmortalWrt 固件。</p><h3 id="_1-1-ext4-和-squashfs-怎么选" tabindex="-1"><a class="header-anchor" href="#_1-1-ext4-和-squashfs-怎么选"><span>1.1 EXT4 和 SQUASHFS 怎么选</span></a></h3><p>详细的解释请见<a href="https://github.com/QiuSimons/YAOF/discussions/511" target="_blank" rel="noopener noreferrer">「扫盲帖」ext4/sfs 固件怎么选择，有什么区别</a>、<a href="https://github.com/QiuSimons/YAOF/discussions/114" target="_blank" rel="noopener noreferrer">ext4和sfs有什么区别</a>，或者自行 Google 搜索。<br> 简单点来说，SQUASHFS 可以重置、扩容镜像和直接升级，而 EXT4 都不能。<br> 对于 arm 设备推荐 SQUASHFS 固件，对于 x86 设备推荐 EXT4 固件。由于 R2S 是 arm 设备，这里我选择的是 SQUASHFS 固件。</p><h2 id="_2-分区扩容" tabindex="-1"><a class="header-anchor" href="#_2-分区扩容"><span>2. 分区扩容</span></a></h2><h3 id="_2-1-安装前扩容-推荐" tabindex="-1"><a class="header-anchor" href="#_2-1-安装前扩容-推荐"><span>2.1 安装前扩容(推荐)</span></a></h3><p>安装前扩容也就是对镜像扩容，仅针对 SQUASHFS 格式。扩容镜像需要在 Linux 环境下，可以是 Openwrt、Debian、Ubuntu 等。这种操作方式相对简单，更推荐使用。</p><div class="vp-steps"><ol><li><p>检查命令</p><p>分别执行<code>which gzip</code>、<code>which dd</code>、<code>which parted</code>命令，检查这些软件是否存在，若不存在则安装，安装方式在不同 Linux 发行版上稍有差异，但都很简单，具体 Google。</p></li><li><p>上传固件</p><p>把下载好的固件(如：<code>immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img.gz</code>)上传至 Linux 环境中，上传位置随意。<br> 这里，我是在 Windows 系统中启用 WSL2 运行了 Ubuntu 系统，打开<code>powershell</code>输入<code>wsl</code>命令连接到 Ubuntu 系统(具体请见<a class="vp-link link" href="/article/ryxmiytl/"><!--[-->WSL2使用<!--]--><!----></a>)。<br> WSL 和 Windows 系统之间文件交换有个小技巧，在命令行中任意目录下输入<code>explorer.exe .</code>就能在资源管理器中打开当前目录；或者手动打开资源管理器，然后在地址栏中输入<code>\\wsl$\</code>就能打开WSL系统中的目录，然后直接复制粘贴文件即可。</p></li><li><p>执行命令</p><p>按顺序执行以下命令(命令中的镜像名字根据实际填写)。注意，如果是 EFI 的固件，在执行这些命令过程中可能会弹出 2 项提示，分别选择：<code>OK</code>、<code>FIX</code>即可。</p><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 解压缩镜像文件，解压完成后这个文件就没用了，可删</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> gzip</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -kd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img.gz</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 解压成功后获得到 immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 扩展镜像文件的大小 (count=2048 表示增加 2048 * 1MB 的空间)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 注意扩容也不是越大越好，因为扩容会增大镜像的体积，这意味着镜像大小将会增加 2GB。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> dd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> if=/dev/zero</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bs=1M</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> count=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2048</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;&gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 使用分区工具操作镜像</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> parted</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 查看分区情况</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> print</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 调整分区大小 (将第 2 个分区扩展至镜像文件的 100%)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 也就是将第 2 个分区大小加了 2GB，这个分区一般是用来安装插件使用的。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> resizepart</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 100%</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 查看是否扩展成功</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> print</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # 退出分区工具</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> quit</span></span></code></pre></div><p>之后把<code>immortalwrt-24.10.0-rockchip-armv8-friendlyarm_nanopi-r2s-squashfs-sysupgrade.img</code>文件拷贝到 Windows 系统中，然后直接刷入这个固件即可。刷入固件的操作步骤在<a class="vp-link link" href="/article/3ocurxag/"><!--[-->软路由之R2S使用<!--]--><!----></a>一文中有详细记录，这里便不再赘述。</p></li></ol></div><h3 id="_2-2-安装后扩容" tabindex="-1"><a class="header-anchor" href="#_2-2-安装后扩容"><span>2.2 安装后扩容</span></a></h3><p>建议先配置好 OpenWrt 的网络，使之可以访问互联网，因为接下来可能需要安装软件。</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><!--[--><button class="active vp-tab-nav" type="button" role="tab" aria-controls="tab-68-0" aria-selected="true"><!--[-->SQUASHFS 格式<!--]--></button><button class="vp-tab-nav" type="button" role="tab" aria-controls="tab-68-1" aria-selected="false"><!--[-->EXT4 格式<!--]--></button><!--]--></div><!--[--><div id="tab-68-0" class="active vp-tab" role="tabpanel" aria-expanded="true"><div class="vp-tab-title"><!--[-->SQUASHFS 格式<!--]--></div><!--[--><div class="vp-steps"><ol><li><p>更新软件包</p><p>在<code>系统</code>&gt;<code>软件包</code>页面点击<code>更新列表</code></p></li><li><p>安装分区工具</p><p>在<code>系统</code>&gt;<code>软件包</code>页面搜索<code>diskman</code>，然后选择<code>luci-i18n-diskman-zh-cn</code>安装。刷新页面后可在<code>系统</code>菜单下看到<code>磁盘管理</code>。</p></li><li><p>禁用自动挂载</p><p>在<code>系统</code>&gt;<code>挂载点</code>&gt;<code>全局设置</code>区域，取消勾选所有的自动挂载项，然后点击<code>保存并应用</code>。</p></li><li><p>创建分区</p><p>在<code>系统</code>&gt;<code>磁盘管理</code>&gt;<code>磁盘</code>区域点<code>编辑</code>，然后在弹出页面的<code>分区信息</code>中最下方，<code>中止扇区</code>位置填写<code>+2g</code>(根据自己需要调整大小，支持的容量格式有：b,k,m,g,t，如：+500m，+1t 等)，格式化为 EXT4 文件系统，然后点击<code>新建</code>，即可创建一个 2GB 空间大小的分区。<br> 注：中止扇区的计算方式，以增加 2GB 为例：((2*1024*1024*1024)/512)+[起始扇区]-1，得到的结果即为中止扇区的值。</p></li><li><p>挂载分区</p><p>在<code>系统</code>&gt;<code>挂载点</code>&gt;<code>挂载点</code>区域点击<code>添加</code>，在<code>常规设置</code>一栏的<code>UUID</code>选中刚刚创建的分区(记下分区名)，<code>挂载点</code>选择<code>作为根文件系统使用(/)</code>。然后复制下方显示出来的多行命令，暂存到记事本中，之后点击<code>保存</code>，再点击<code>保存并应用</code>。</p></li><li><p>执行命令</p><p>使用<code>ssh root@192.168.100.1</code>登录到系统(这里<code>root</code>是用户名，<code>192.168.100.1</code>是软路由系统的地址，根据实际情况填写)，将刚才复制的多行命令中，其中<code>/dev/sda1</code>修改为<code>/dev/实际创建的分区名</code>，然后复制粘贴到命令行窗口，多点几次回车，直到执行完成。</p></li><li><p>重启系统</p><p>重启软路由系统。</p></li></ol></div><!--]--></div><div id="tab-68-1" class="vp-tab" role="tabpanel" aria-expanded="false"><div class="vp-tab-title"><!--[-->EXT4 格式<!--]--></div><!--[--><div class="vp-steps"><ol><li><p>更新软件包</p><p>在<code>系统</code>&gt;<code>软件包</code>页面点击<code>更新列表</code></p></li><li><p>安装分区工具</p><p>在<code>系统</code>&gt;<code>软件包</code>页面搜索<code>diskman</code>，然后选择<code>luci-i18n-diskman-zh-cn</code>安装。刷新页面后可在<code>系统</code>菜单下看到<code>磁盘管理</code>。</p></li><li><p>禁用自动挂载</p><p>在<code>系统</code>&gt;<code>挂载点</code>&gt;<code>全局设置</code>区域，取消勾选所有的自动挂载项，然后点击<code>保存并应用</code>。</p></li><li><p>创建分区</p><p>在<code>系统</code>&gt;<code>磁盘管理</code>&gt;<code>磁盘</code>区域点<code>编辑</code>，然后在弹出页面的<code>分区信息</code>中最下方，<code>中止扇区</code>位置填写<code>+2g</code>(根据自己需要调整大小，支持的容量格式有：b,k,m,g,t，如：+500m，+1t 等)，格式化为 EXT4 文件系统，然后点击<code>新建</code>，即可创建一个 2GB 空间大小的分区。<br> 题外话：中止扇区的计算方式，以增加 2GB 为例：((2*1024*1024*1024)/512)+[起始扇区]-1，得到的结果即为中止扇区的值。</p></li><li><p>挂载分区</p><p>在<code>系统</code>&gt;<code>挂载点</code>&gt;<code>挂载点</code>区域点击<code>添加</code>，在<code>常规设置</code>一栏的<code>UUID</code>选中刚刚创建的分区(记下分区名)，<code>挂载点</code>例如为<code>/mnt/sda3</code>，sda3 可随意命令，目的是拷贝overlay文件用。之后点击<code>保存</code>，再点击<code>保存并应用</code>。</p></li><li><p>执行命令</p><p>使用<code>ssh root@192.168.100.1</code>登录到系统(这里<code>root</code>是用户名，<code>192.168.100.1</code>是软路由系统的地址，根据实际情况填写)，执行命令<code>cp -r /overlay/* /mnt/sda3</code>，将原overlay下的配置拷贝至新分区。</p></li><li><p>检查分区</p><p>查看新分区目录是否拷贝成功，如果成功则在<code>系统</code>&gt;<code>挂载点</code>&gt;<code>挂载点</code>区域删除刚才的<code>/mnt/sda3</code>挂载。</p></li><li><p>重新挂载分区</p><p>再次进入<code>系统</code>&gt;<code>挂载点</code>&gt;<code>挂载点</code>区域点击<code>添加</code>，选择刚才的新分区，<code>挂载点</code>选择为<code>作为外部 overlay 使用(/overlay)</code>，之后点击<code>保存</code>，再点击<code>保存并应用</code>。</p></li><li><p>重启系统</p><p>重启软路由系统。</p></li></ol></div><!--]--></div><!--]--></div><h2 id="_3-安装-docker" tabindex="-1"><a class="header-anchor" href="#_3-安装-docker"><span>3. 安装 Docker</span></a></h2><p>在安装 Docker 前，我们可以先安装<code>argon</code>主题。在<code>软件包</code>页面更新列表后，搜索<code>argon</code>，然后选择<code>luci-theme-argon</code>安装即可，如果需要设置主体再安装<code>luci-i18n-argon-config-zh-cn</code>。<br> Docker 使用的根目录通常是<code>/opt/docker</code>，在安装之前，最好手动创建一个分区并挂载到<code>/opt/docker</code>，否则若直接安装 Docker 会自动创建分区挂载到根目录下，那样会限制使用。</p><div class="vp-steps"><ol><li><p>创建分区</p><p>进入<code>系统</code>&gt;<code>磁盘管理</code>&gt;<code>磁盘</code>区域点<code>编辑</code>，然后在弹出页面的<code>分区信息</code>中最下方，<code>中止扇区</code>位置填写<code>+20g</code>(根据个人需求，+10g也行)。如果有使用<code>AdGuardHome</code>的需求，必须将分区格式化化为<code>btrfs</code>，否则亦可格式化为<code>ext4</code>。</p></li><li><p>挂载分区</p><p>进入<code>系统</code>&gt;<code>挂载点</code>&gt;<code>挂载点</code>区域点击<code>添加</code>，选择刚才的新分区，<code>挂载点</code>为<code>/opt/docker</code>，之后点击<code>保存</code>，再点击<code>保存并应用</code>。</p></li><li><p>安装 Docker</p><p>在<code>系统</code>&gt;<code>软件包</code>页面点击<code>更新列表</code>，然后搜索<code>docker</code>，然后选择<code>luci-i18n-dockerman-zh-cn</code>安装。<br> 安装完成后建议等上3~5分钟，后台可能有操作没执行完。之后刷新页面后可在菜单下看到<code>Docker</code>。</p></li></ol></div><p>启动 Docker 后便可在<code>Docker</code>&gt;<code>概览</code>中看到<code>Docker 根目录</code>的空间大小。亦可通过 ssh 命令进入到软路由系统中，使用<code>df -h /opt/docker</code>查看 Docker 分区大小。</p><p>之后便可部署直播源或者其他容器啦~~</p><h2 id="_4-配置防火墙" tabindex="-1"><a class="header-anchor" href="#_4-配置防火墙"><span>4. 配置防火墙</span></a></h2><p>上面在部署完直播源后，容器运行正常，查看日志也正常，通过 ssh 进入到软路由系统中去访问 Docker 容器也正常，但就是使用其他非软路由设备无法访问到 Docker 容器。<br> 这大概率就是防火墙不通导致，于是了解了下 OpenWrt 防火墙的概念。下面这个图表达了防火墙各设备之间的概念关系。</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div style="display:flex;align-items:center;justify-content:center;height:96px;" class="mermaid-loading"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);--icon-size: 48px;display: inline-block;width: var(--icon-size);height: var(--icon-size);background-color: currentcolor;-webkit-mask-image: var(--loading-icon);mask-image: var(--loading-icon)"></span></div></div><!--]--><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div style="display:flex;align-items:center;justify-content:center;height:96px;" class="mermaid-loading"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);--icon-size: 48px;display: inline-block;width: var(--icon-size);height: var(--icon-size);background-color: currentcolor;-webkit-mask-image: var(--loading-icon);mask-image: var(--loading-icon)"></span></div></div><!--]--><p>这里有几个概念：转发、出入站。</p><ul><li>转发：区域内相同网段(192.168.0.*)由交换机直接转发，不受防火墙控制；区域内不同网段(192.168.0.*与192.168.1.*)以及区域间的转发，由路由转发，受防火墙控制。</li><li>出入站：这里的站是指路由器，流入路由器的数据就是入站，流出路由器的数据就是出站。</li></ul><p>在了解了上述这些之后，可以想到，<code>LAN区域</code>-&gt;<code>Docker区域</code>必须能转发，并且<code>Docker区域</code>-&gt;<code>WAN区域</code>必须也能转发，所以防火墙的配置如下图所示。</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/20250211/openwrt.9nzwsujca9.webp" alt="openwrt"></p><p>至此，便可正常获取到电视直播源并且观看了。</p><p>OpenWrt 的折腾暂时告一段落~~</p><h2 id="_5-配置pwmfan" tabindex="-1"><a class="header-anchor" href="#_5-配置pwmfan"><span>5. 配置PWMFAN</span></a></h2><p>原版的 R2S 固件中是有 pwmfan 的，也就是根据 CPU 温度控制风扇是否启用。但由于我们刷的是并非原版固件，所以当前固件中是没有这个设置的，只能通过脚本方式来执行。</p><div class="vp-steps"><ol><li><p>下载脚本</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 下载 start-rk3328-pwm-fan.sh</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -P</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/bin</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://raw.githubusercontent.com/friendlyarm/friendlywrt/refs/heads/master-v19.07.1/target/linux/rockchip-rk3328/base-files/usr/bin/start-rk3328-pwm-fan.sh</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 下载 fa-rk3328-pwmfan</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -P</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/init.d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://raw.githubusercontent.com/friendlyarm/friendlywrt/refs/heads/master-v19.07.1/target/linux/rockchip-rk3328/base-files/etc/init.d/fa-rk3328-pwmfan</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>执行脚本</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 添加执行权限</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /usr/bin/start-rk3328-pwm-fan.sh</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> +x</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/init.d/fa-rk3328-pwmfan</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # 执行脚本</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   /etc/init.d/fa-rk3328-pwmfan</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">   /etc/init.d/fa-rk3328-pwmfan</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></div><h2 id="_6-官方源" tabindex="-1"><a class="header-anchor" href="#_6-官方源"><span>6. 官方源</span></a></h2><p>如果不小心删掉了官方源，则可以在后台<code>系统</code>-&gt;<code>软件包</code>点击<code>配置 opkg</code>:</p><ul><li><code>/etc/opkg.conf</code>: 一般不需要改动。仅在需要修改安装目录或设置代理时手动配置。</li><li><code>/etc/opkg/customfeeds.conf</code>: 一般不需要改动。仅在需要添加第三方源或本地仓库时手动配置。</li><li><code>/etc/opkg/distfeeds.conf</code>: 必须配置。官方源的核心配置文件，确保正确填写以访问官方软件包。</li></ul><div class="code-block-title" data-title="distfeeds.conf"><div class="code-block-title-bar"><span class="title"><!---->distfeeds.conf</span></div><div class="language-text" data-highlighter="shiki" data-ext="text" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-text"><span class="line"><span>src/gz base https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/packages</span></span>
<span class="line"><span>src/gz luci https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/luci</span></span>
<span class="line"><span>src/gz packages https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/base</span></span>
<span class="line"><span>src/gz routing https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/routing</span></span>
<span class="line"><span>src/gz telephony https://downloads.immortalwrt.org/releases/24.10.1/packages/aarch64_generic/telephony</span></span></code></pre></div></div><p><strong>注意</strong>：<code>24.10.1</code>是系统版本，<code>aarch64_generic</code>是 CPU 架构，要根据实际情况填写。</p><h2 id="_7-固件编译" tabindex="-1"><a class="header-anchor" href="#_7-固件编译"><span>7. 固件编译</span></a></h2><p>官方固件<a href="https://firmware-selector.immortalwrt.org/" target="_blank" rel="noopener noreferrer">下载</a>页提供了个性化编译的界面，可以增加预安装软件包(得是官方源有的才行)，和首次运行脚本。这里我提供一个脚本如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#!/bin/sh</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># /etc/uci-defaults/99-setup.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 设置 LAN 口 ip</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.lan.proto=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">static</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.lan.ipaddr=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.0.1</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.lan.netmask=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">255.255.255.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 设置 pppoe 拨号</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#uci set network.wan.proto=&#39;pppoe&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#uci set network.wan.username=&#39;123456&#39;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#uci set network.wan.password=&#39;123456&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 设置访问光猫</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem=interface</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.proto=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">static</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.ipaddr=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.1.254</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.netmask=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">255.255.255.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.ifname=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">eth0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network.modem.defaultroute=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 提交生效</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uci</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> commit</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> network</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">exit</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此脚本会在首次启动时自动运行，正常退出后会自动删除该脚本。</p><hr><h2 id="_8-ipv6配置" tabindex="-1"><a class="header-anchor" href="#_8-ipv6配置"><span>8. IPv6配置</span></a></h2><p>为了内网中的服务能被公网通过 IPv6 访问(访问内网的 Sub-Store 服务)，还需要做如下两处设置(仅适用于主路由模式下)，默认情况下它们都是<code>已禁用</code>：</p><p><img src="https://cdn.jsdelivr.net/gh/Ma-yeah/picx-images-hosting@master/20250211/ipv6.8hgta5g6kk.webp" alt="ipv6"></p><div class="hint-container note"><p class="hint-container-title">本文参考</p><ul><li><a href="https://www.qichiyu.com/183.html#heading-2-1" target="_blank" rel="noopener noreferrer">openwrt基础配置</a></li></ul></div></div><!----><!----><div class="vp-doc-copyright" data-v-5e118bb0><h2 id="doc-copyright" tabindex="-1" class="vp-doc-header" data-v-53b95284><a href="#doc-copyright" class="header-anchor" data-v-53b95284><span data-v-53b95284><!--[-->版权所有<!--]--></span></a></h2><div class="hint-container tip copyright-container" data-v-79711e76><p data-v-79711e76><span data-v-79711e76>版权归属：</span><a class="vp-link link no-icon" href="https://github.com/Mayee" target="_blank" rel="noreferrer" data-v-79711e76><!--[-->Mayee<!--]--><!----></a></p><!----><p data-v-79711e76><span data-v-79711e76>许可证：</span><a class="vp-link link no-icon" href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noreferrer" data-v-79711e76><!--[-->署名 4.0 国际 (CC-BY-4.0)<!--]--><!----></a><!--[--><span class="vpi-license-cc" data-v-79711e76></span><span class="vpi-license-by" data-v-79711e76></span><!--]--></p></div></div></div></main><footer class="vp-doc-footer" data-v-5e118bb0 data-v-3078abbd><!--[--><!--]--><!----><div class="contributors" aria-label="Contributors" data-v-3078abbd><span class="contributors-label" data-v-3078abbd>贡献者: </span><span class="contributors-info" data-v-3078abbd><!--[--><!--[--><span class="contributor" data-v-3078abbd>Mayee</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-3078abbd><div class="pager" data-v-3078abbd><a class="vp-link link pager-link prev" href="/article/0be86xd9/" data-v-3078abbd><!--[--><span class="desc" data-v-3078abbd>上一页</span><span class="title" data-v-3078abbd><!----><span data-v-3078abbd>OpenWrt系统使用</span></span><!--]--><!----></a></div><div class="pager" data-v-3078abbd><a class="vp-link link pager-link next" href="/article/ryxmiytl/" data-v-3078abbd><!--[--><span class="desc" data-v-3078abbd>下一页</span><span class="title" data-v-3078abbd><!----><span data-v-3078abbd>WSL2使用</span></span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button type="button" class="vp-back-to-top" aria-label="back to top" data-v-dd2ea341 style="display:none;" data-v-d4e26b45><span class="percent" data-allow-mismatch data-v-d4e26b45>0%</span><span class="show icon vpi-back-to-top" data-v-d4e26b45></span><svg aria-hidden="true" data-v-d4e26b45><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-d4e26b45></circle></svg></button><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" aria-label="sign down" class="vp-sign-down" aria-hidden="true" data-v-dd2ea341 style="display:none;" data-v-2a7cf2ea><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" data-v-2a7cf2ea><path d="m19 11l-7 6l-7-6" data-v-2a7cf2ea></path><path d="m19 5l-7 6l-7-6" opacity="0.6" data-v-2a7cf2ea></path></g></svg><footer class="vp-footer" vp-footer data-v-dd2ea341 data-v-b55ba299><!--[--><div class="container" data-v-b55ba299><!----><p class="copyright" data-v-b55ba299>©2021 Mayee</p></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-B_sKV6fk.js" defer></script></body></html>